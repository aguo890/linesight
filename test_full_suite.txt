============================= test session starts =============================
platform win32 -- Python 3.13.5, pytest-9.0.2, pluggy-1.6.0 -- C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\19803\Projects\FactoryExcelManager\backend
configfile: pytest.ini
plugins: anyio-4.12.1, Faker-40.1.0, langsmith-0.6.1, asyncio-1.3.0, cov-7.0.0, mock-3.15.1
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 239 items

backend\tests\api\test_analytics_flaws.py::test_hourly_production_no_events_returns_zeros FAILED [  0%]
backend\tests\api\test_analytics_flaws.py::test_midnight_boundary_respects_timezone FAILED [  0%]
backend\tests\api\v1\test_factory_settings.py::test_factory_settings_localization_and_snapshot FAILED [  1%]
backend\tests\api\v1\test_team.py::test_list_members_as_owner ERROR      [  1%]
backend\tests\api\v1\test_team.py::test_list_members_as_manager_forbidden ERROR [  2%]
backend\tests\api\v1\test_team.py::test_assign_user_to_line ERROR        [  2%]
backend\tests\api\v1\test_team.py::test_remove_user_scope ERROR          [  2%]
backend\tests\api\v1\test_team.py::test_cannot_assign_cross_org_user ERROR [  3%]
backend\tests\api\v1\test_users.py::test_get_user_me PASSED              [  3%]
backend\tests\api\v1\test_users.py::test_update_user_me PASSED           [  4%]
backend\tests\api\v1\test_users.py::test_update_user_invalid_timezone PASSED [  4%]
backend\tests\api\v1\test_users.py::test_update_user_partial_preferences PASSED [  5%]
backend\tests\api\v1\test_users.py::test_update_user_invalid_preference_type FAILED [  5%]
backend\tests\e2e\test_excel_to_dashboard.py::test_e2e_excel_ingestion_and_dashboard ERROR [  5%]
backend\tests\test_api\test_ai_decisions.py::test_list_ai_decisions PASSED [  6%]
backend\tests\test_api\test_ai_decisions.py::test_list_ai_decisions_with_filters PASSED [  6%]
backend\tests\test_api\test_ai_decisions.py::test_get_ai_decision_by_id PASSED [  7%]
backend\tests\test_api\test_ai_decisions.py::test_get_ai_decision_not_found PASSED [  7%]
backend\tests\test_api\test_ai_decisions.py::test_get_data_source_ai_decisions FAILED [  7%]
backend\tests\test_api\test_ai_decisions.py::test_ai_decisions_pagination PASSED [  8%]
backend\tests\test_api\test_ai_decisions.py::test_ai_decisions_require_auth PASSED [  8%]
backend\tests\test_api\test_analytics_real.py::test_get_overview_stats_real PASSED [  9%]
backend\tests\test_api\test_analytics_real.py::test_get_production_chart_real PASSED [  9%]
backend\tests\test_api\test_analytics_real.py::test_get_lowest_performers_real PASSED [ 10%]
backend\tests\test_api\test_analytics_real.py::test_get_discrepancies_real PASSED [ 10%]
backend\tests\test_api\test_auth.py::test_login_success FAILED           [ 10%]
backend\tests\test_api\test_auth.py::test_login_invalid_password FAILED  [ 11%]
backend\tests\test_api\test_auth.py::test_login_user_not_found PASSED    [ 11%]
backend\tests\test_api\test_auth.py::test_register_success PASSED        [ 12%]
backend\tests\test_api\test_dashboard_creation_flow.py::test_complete_dashboard_creation_flow FAILED [ 12%]
backend\tests\test_api\test_dashboard_creation_flow.py::test_dashboard_creation_blocked_by_factory_quota FAILED [ 12%]
backend\tests\test_api\test_dashboard_creation_flow.py::test_dashboard_creation_blocked_by_line_quota SKIPPED [ 13%]
backend\tests\test_api\test_dashboard_creation_flow.py::test_multiple_dashboards_same_data_source FAILED [ 13%]
backend\tests\test_api\test_dashboard_creation_flow.py::test_list_dashboards_filtered_by_factory FAILED [ 14%]
backend\tests\test_api\test_dashboard_flow.py::test_edit_configuration ERROR [ 14%]
backend\tests\test_api\test_dashboard_flow.py::test_view_uploaded_files ERROR [ 15%]
backend\tests\test_api\test_dashboard_flow.py::test_upload_history_isolation ERROR [ 15%]
backend\tests\test_api\test_dashboard_flow.py::test_upload_history_simple_endpoint ERROR [ 15%]
backend\tests\test_api\test_dashboard_widgets.py::test_get_dhu_quality_trend FAILED [ 16%]
backend\tests\test_api\test_dashboard_widgets.py::test_get_style_progress FAILED [ 16%]
backend\tests\test_api\test_data_pipeline_robust.py::test_value_preservation_through_pipeline ERROR [ 17%]
backend\tests\test_api\test_data_pipeline_robust.py::test_date_format_handling ERROR [ 17%]
backend\tests\test_api\test_data_pipeline_robust.py::test_efficiency_normalization ERROR [ 17%]
backend\tests\test_api\test_data_pipeline_robust.py::test_null_handling ERROR [ 18%]
backend\tests\test_api\test_data_pipeline_robust.py::test_data_integrity_across_multiple_rows ERROR [ 18%]
backend\tests\test_api\test_data_pipeline_robust.py::test_style_and_order_creation ERROR [ 19%]
backend\tests\test_api\test_data_pipeline_robust.py::test_duplicate_upload_handling ERROR [ 19%]
backend\tests\test_api\test_data_pipeline_robust.py::test_multiple_widgets_receive_correct_data ERROR [ 20%]
backend\tests\test_api\test_data_pipeline_robust.py::test_invalid_data_handling ERROR [ 20%]
backend\tests\test_api\test_data_pipeline_robust.py::test_analytics_sum_matches_database ERROR [ 20%]
backend\tests\test_api\test_datasource.py::test_create_data_source FAILED [ 21%]
backend\tests\test_api\test_datasource.py::test_get_data_source ERROR    [ 21%]
backend\tests\test_api\test_datasource.py::test_get_data_source_by_line ERROR [ 22%]
backend\tests\test_api\test_datasource.py::test_update_schema_mapping ERROR [ 22%]
backend\tests\test_api\test_datasource.py::test_create_duplicate_data_source_fails ERROR [ 23%]
backend\tests\test_api\test_datasources_by_line.py::test_get_datasource_by_line_exists ERROR [ 23%]
backend\tests\test_api\test_datasources_by_line.py::test_get_datasource_by_line_none ERROR [ 23%]
backend\tests\test_api\test_datasources_by_line.py::test_get_datasource_cross_line_isolation ERROR [ 24%]
backend\tests\test_api\test_datasources_by_line.py::test_update_datasource ERROR [ 24%]
backend\tests\test_api\test_demo_pipeline.py::test_demo_full_pipeline_with_excel_file ERROR [ 25%]
backend\tests\test_api\test_demo_pipeline.py::test_demo_data_values_integrity ERROR [ 25%]
backend\tests\test_api\test_destructive_flows.py::test_delete_datasource_cascade FAILED [ 25%]
backend\tests\test_api\test_destructive_flows.py::test_clear_history_file_cleanup FAILED [ 26%]
backend\tests\test_api\test_destructive_flows.py::test_clear_history_missing_file FAILED [ 26%]
backend\tests\test_api\test_destructive_flows.py::test_permissions_restricted_delete FAILED [ 27%]
backend\tests\test_api\test_destructive_flows.py::test_deep_data_cleanup FAILED [ 27%]
backend\tests\test_api\test_destructive_flows.py::test_cross_tenant_isolation FAILED [ 28%]
backend\tests\test_api\test_destructive_flows.py::test_audit_logging_mock FAILED [ 28%]
backend\tests\test_api\test_dry_run_flow.py::test_dry_run_preview_structure ERROR [ 28%]
backend\tests\test_api\test_dry_run_flow.py::test_date_auto_fixing_detection ERROR [ 29%]
backend\tests\test_api\test_dry_run_flow.py::test_efficiency_percentage_cleaning ERROR [ 29%]
backend\tests\test_api\test_dry_run_flow.py::test_decimal_field_handling ERROR [ 30%]
backend\tests\test_api\test_dry_run_flow.py::test_integer_field_cleaning ERROR [ 30%]
backend\tests\test_api\test_dry_run_flow.py::test_column_mapping_application ERROR [ 30%]
backend\tests\test_api\test_dry_run_flow.py::test_overall_status_with_warnings ERROR [ 31%]
backend\tests\test_api\test_dry_run_flow.py::test_overall_status_all_valid ERROR [ 31%]
backend\tests\test_api\test_dry_run_flow.py::test_promotion_after_dry_run_approval ERROR [ 32%]
backend\tests\test_api\test_dry_run_flow.py::test_dry_run_with_missing_schema_mapping ERROR [ 32%]
backend\tests\test_api\test_dry_run_flow.py::test_dry_run_limits_to_20_rows ERROR [ 33%]
backend\tests\test_api\test_dry_run_flow.py::test_raw_data_preserved_in_preview ERROR [ 33%]
backend\tests\test_api\test_error_handling.py::test_404_json_response PASSED [ 33%]
backend\tests\test_api\test_error_handling.py::test_validation_error_json_response PASSED [ 34%]
backend\tests\test_api\test_error_handling.py::test_upload_bad_file_json_response PASSED [ 34%]
backend\tests\test_api\test_error_handling.py::test_delete_204_response FAILED [ 35%]
backend\tests\test_api\test_excel_to_widget_integrity.py::test_golden_master_excel_to_overview_widget FAILED [ 35%]
backend\tests\test_api\test_excel_to_widget_integrity.py::test_golden_master_physics_validation_triggers FAILED [ 35%]
backend\tests\test_api\test_factories.py::test_create_factory FAILED     [ 36%]
backend\tests\test_api\test_factories.py::test_list_factories FAILED     [ 36%]
backend\tests\test_api\test_factories.py::test_production_line_crud FAILED [ 37%]
backend\tests\test_api\test_fallback_logic.py::test_overview_fallback FAILED [ 37%]
backend\tests\test_api\test_fallback_logic.py::test_production_chart_fallback PASSED [ 38%]
backend\tests\test_api\test_fallback_logic.py::test_sam_performance_fallback FAILED [ 38%]
backend\tests\test_api\test_fallback_logic.py::test_hourly_fallback FAILED [ 38%]
backend\tests\test_api\test_individual_widgets.py::test_get_hourly_production FAILED [ 39%]
backend\tests\test_api\test_individual_widgets.py::test_get_sam_performance FAILED [ 39%]
backend\tests\test_api\test_individual_widgets.py::test_get_workforce_stats FAILED [ 40%]
backend\tests\test_api\test_individual_widgets.py::test_get_dhu_history FAILED [ 40%]
backend\tests\test_api\test_individual_widgets.py::test_get_speed_vs_quality FAILED [ 41%]
backend\tests\test_api\test_individual_widgets.py::test_get_complexity_impact PASSED [ 41%]
backend\tests\test_api\test_individual_widgets.py::test_get_downtime_reasons PASSED [ 41%]
backend\tests\test_api\test_ingestion_deduplication.py::test_ingestion_deduplication FAILED [ 42%]
backend\tests\test_api\test_ingestion_deduplication.py::test_mapping_state_endpoint FAILED [ 42%]
backend\tests\test_api\test_ingestion_deduplication.py::test_process_idempotency FAILED [ 43%]
backend\tests\test_api\test_ingestion_flow.py::test_full_ingestion_flow FAILED [ 43%]
backend\tests\test_api\test_ingestion_flow.py::test_schema_evolution FAILED [ 43%]
backend\tests\test_api\test_integrity.py::test_pydantic_validation PASSED [ 44%]
backend\tests\test_api\test_integrity.py::test_canonical_mapping_validation FAILED [ 44%]
backend\tests\test_api\test_integrity.py::test_order_hybrid_property PASSED [ 45%]
backend\tests\test_api\test_integrity.py::test_production_run_constraints PASSED [ 45%]
backend\tests\test_api\test_line_management.py::test_reset_schema_configuration FAILED [ 46%]
backend\tests\test_api\test_line_management.py::test_clear_upload_history FAILED [ 46%]
backend\tests\test_api\test_organizations.py::test_get_my_organization PASSED [ 46%]
backend\tests\test_api\test_organizations.py::test_update_my_organization PASSED [ 47%]
backend\tests\test_api\test_organizations.py::test_get_organization_by_id PASSED [ 47%]
backend\tests\test_api\test_preview.py::test_preview_endpoint_success FAILED [ 48%]
backend\tests\test_api\test_preview.py::test_list_uploads_includes_datasource_id FAILED [ 48%]
backend\tests\test_api\test_preview_dry_run_endpoint.py::test_preview_dry_run_endpoint ERROR [ 48%]
backend\tests\test_api\test_production.py::test_style_crud PASSED        [ 49%]
backend\tests\test_api\test_production.py::test_order_crud PASSED        [ 49%]
backend\tests\test_api\test_production.py::test_production_run_lifecycle FAILED [ 50%]
backend\tests\test_api\test_production.py::test_create_order_invalid_style PASSED [ 50%]
backend\tests\test_api\test_production.py::test_create_run_factory_mismatch PASSED [ 51%]
backend\tests\test_api\test_promotion.py::test_promotion_logic_full_cycle FAILED [ 51%]
backend\tests\test_api\test_quality_constraints.py::test_quality_inspection_allows_different_types_per_run PASSED [ 51%]
backend\tests\test_api\test_quality_constraints.py::test_quality_inspection_rejects_duplicate_type_per_run PASSED [ 52%]
backend\tests\test_api\test_quality_import.py::test_quality_data_promotion ERROR [ 52%]
backend\tests\test_api\test_quota_enforcement.py::test_factory_quota_enforced FAILED [ 53%]
backend\tests\test_api\test_quota_enforcement.py::test_line_quota_enforced ERROR [ 53%]
backend\tests\test_api\test_quota_enforcement.py::test_soft_deleted_factories_not_counted FAILED [ 53%]
backend\tests\test_api\test_quota_enforcement.py::test_quota_status_endpoint ERROR [ 54%]
backend\tests\test_api\test_quota_enforcement.py::test_enterprise_tier_quotas FAILED [ 54%]
backend\tests\test_api\test_quota_enforcement.py::test_quota_at_exact_limit FAILED [ 55%]
backend\tests\test_api\test_quota_enforcement.py::test_zero_quota_blocks_creation FAILED [ 55%]
backend\tests\test_api\test_repro_500.py::test_list_dashboards_by_factory_id_crash FAILED [ 56%]
backend\tests\test_api\test_samples.py::test_list_sample_files FAILED    [ 56%]
backend\tests\test_api\test_samples.py::test_download_sample_file FAILED [ 56%]
backend\tests\test_api\test_samples.py::test_download_csv_sample_file FAILED [ 57%]
backend\tests\test_api\test_samples.py::test_download_nonexistent_file PASSED [ 57%]
backend\tests\test_api\test_samples.py::test_download_with_path_traversal_attempt PASSED [ 58%]
backend\tests\test_api\test_samples.py::test_sample_files_have_descriptions PASSED [ 58%]
backend\tests\test_api\test_schema_config.py::test_schema_configuration_flow FAILED [ 58%]
backend\tests\test_api\test_schema_mapping_reuse.py::test_confirm_mapping_deactivates_previous FAILED [ 59%]
backend\tests\test_api\test_schema_mapping_reuse.py::test_schema_mapping_version_increments_correctly FAILED [ 59%]
backend\tests\test_api\test_storage_separation.py::test_storage_segmentation FAILED [ 60%]
backend\tests\test_api\test_style_progress.py::test_get_style_progress_with_pending_orders FAILED [ 60%]
backend\tests\test_api\test_upload.py::TestUploadEndpoints::test_upload_endpoint_requires_auth PASSED [ 61%]
backend\tests\test_api\test_upload.py::TestUploadEndpoints::test_upload_rejects_non_excel FAILED [ 61%]
backend\tests\test_api\test_upload.py::TestUploadEndpoints::test_upload_accepts_xlsx FAILED [ 61%]
backend\tests\test_api\test_upload_history.py::test_upload_history_segmentation FAILED [ 62%]
backend\tests\test_api\test_upload_preview.py::test_upload_csv_file FAILED [ 62%]
backend\tests\test_api\test_upload_preview.py::test_preview_csv_file FAILED [ 63%]
backend\tests\test_api\test_upload_preview.py::test_preview_excel_file FAILED [ 63%]
backend\tests\test_api\test_upload_preview.py::test_preview_nonexistent_file PASSED [ 64%]
backend\tests\test_api\test_upload_preview.py::test_upload_invalid_file_extension PASSED [ 64%]
backend\tests\test_api\test_verification_cascade.py::test_factory_deletion_cascade_behavior FAILED [ 64%]
backend\tests\test_api\test_widget_data_e2e.py::test_full_widget_data_flow FAILED [ 65%]
backend\tests\test_api\test_widget_data_e2e.py::test_widget_endpoint_with_line_filter FAILED [ 65%]
backend\tests\test_async_flow.py::test_datasource_lifecycle FAILED       [ 66%]
backend\tests\test_datasource_flow.py::test_datasource_flow FAILED       [ 66%]
backend\tests\test_ingestion\test_full_flow.py::test_full_data_flow FAILED [ 66%]
backend\tests\test_mapping_intelligence.py::test_mapping_engine_intelligence PASSED [ 67%]
backend\tests\test_sequential_ingestion.py::test_jan_feb_march_continuity FAILED [ 67%]
backend\tests\test_services\test_ai_decision_logging.py::test_ai_decision_creation PASSED [ 68%]
backend\tests\test_services\test_ai_decision_logging.py::test_schema_inference_logging FAILED [ 68%]
backend\tests\test_services\test_ai_decision_logging.py::test_code_generation_logging FAILED [ 69%]
backend\tests\test_services\test_ai_decision_logging.py::test_ai_decision_without_db_session PASSED [ 69%]
backend\tests\test_services\test_ai_decision_logging.py::test_ai_decision_data_source_relationship FAILED [ 69%]
backend\tests\test_services\test_ai_decision_logging.py::test_ai_decision_confidence_calculation FAILED [ 70%]
backend\tests\test_services\test_ai_decision_logging.py::test_ai_decision_metadata_completeness FAILED [ 70%]
backend\tests\test_services\test_analytics_service.py::test_get_aggregated_stats_standard PASSED [ 71%]
backend\tests\test_services\test_analytics_service.py::test_get_aggregated_stats_weighted_check PASSED [ 71%]
backend\tests\test_services\test_analytics_service.py::test_validate_production_physics_rules PASSED [ 71%]
backend\tests\test_services\test_date_parser.py::TestDateParser::test_native_types PASSED [ 72%]
backend\tests\test_services\test_date_parser.py::TestDateParser::test_format_spec PASSED [ 72%]
backend\tests\test_services\test_date_parser.py::TestDateParser::test_excel_serials PASSED [ 73%]
backend\tests\test_services\test_date_parser.py::TestDateParser::test_heuristics_dayfirst PASSED [ 73%]
backend\tests\test_services\test_date_parser.py::TestDateParser::test_diagnostics_return PASSED [ 74%]
backend\tests\test_services\test_date_parser.py::TestDateParser::test_invalid_inputs PASSED [ 74%]
backend\tests\test_services\test_excel_parser.py::TestFlexibleExcelParser::test_fuzzy_column_matching_qty PASSED [ 74%]
backend\tests\test_services\test_excel_parser.py::TestFlexibleExcelParser::test_fuzzy_column_matching_po PASSED [ 75%]
backend\tests\test_services\test_excel_parser.py::TestFlexibleExcelParser::test_header_scoring PASSED [ 75%]
backend\tests\test_services\test_excel_parser.py::TestFlexibleExcelParser::test_clean_column_name PASSED [ 76%]
backend\tests\test_services\test_excel_parser.py::TestFlexibleExcelParser::test_empty_columns_filtered PASSED [ 76%]
backend\tests\test_services\test_file_processor.py::TestFileProcessorDryRun::test_dry_run_preview_basic PASSED [ 76%]
backend\tests\test_services\test_file_processor.py::TestFileProcessorDryRun::test_dry_run_detects_date_warnings PASSED [ 77%]
backend\tests\test_services\test_file_processor.py::TestFileProcessorDryRun::test_dry_run_shows_before_after PASSED [ 77%]
backend\tests\test_services\test_file_processor.py::TestFileProcessorDryRun::test_dry_run_no_warnings_for_clean_data PASSED [ 78%]
backend\tests\test_services\test_file_processor.py::TestFileProcessorDryRun::test_dry_run_limits_to_20_rows PASSED [ 78%]
backend\tests\test_services\test_file_processor.py::TestDataCleaning::test_clean_date_messy_format PASSED [ 79%]
backend\tests\test_services\test_file_processor.py::TestDataCleaning::test_clean_date_full_format PASSED [ 79%]
backend\tests\test_services\test_file_processor.py::TestDataCleaning::test_clean_integer_fields PASSED [ 79%]
backend\tests\test_services\test_file_processor.py::TestDataCleaning::test_clean_decimal_fields PASSED [ 80%]
backend\tests\test_services\test_file_processor.py::TestDataCleaning::test_clean_efficiency_percentage PASSED [ 80%]
backend\tests\test_services\test_file_processor.py::TestDataCleaning::test_clean_none_values PASSED [ 81%]
backend\tests\test_services\test_file_processor.py::TestDataCleaning::test_clean_string_fields PASSED [ 81%]
backend\tests\test_services\test_file_processor.py::TestProductionRunInsertion::test_promote_delegates_to_orchestrator PASSED [ 82%]
backend\tests\test_services\test_file_processor.py::TestProductionRunInsertion::test_promote_handles_already_promoted PASSED [ 82%]
backend\tests\test_services\test_fuzzy_matcher_optimized.py::test_fuzzy_matcher_wratio_handling PASSED [ 82%]
backend\tests\test_services\test_fuzzy_matcher_optimized.py::test_short_word_protection PASSED [ 83%]
backend\tests\test_services\test_fuzzy_matcher_optimized.py::test_industry_variations PASSED [ 83%]
backend\tests\test_services\test_fuzzy_matcher_optimized.py::test_match_with_alternatives_deduplication PASSED [ 84%]
backend\tests\test_services\test_fuzzy_matcher_optimized.py::test_performance_cached_keys PASSED [ 84%]
backend\tests\test_services\test_matching_engine_new.py::test_hash_matcher_exact PASSED [ 84%]
backend\tests\test_services\test_matching_engine_new.py::test_hash_matcher_alias PASSED [ 85%]
backend\tests\test_services\test_matching_engine_new.py::test_fuzzy_matcher PASSED [ 85%]
backend\tests\test_services\test_matching_engine_new.py::test_unmatched_column PASSED [ 86%]
backend\tests\test_services\test_matching_engine_new.py::test_case_insensitivity PASSED [ 86%]
backend\tests\test_services\test_matching_engine_new.py::test_operator_plurality_mismatch PASSED [ 87%]
backend\tests\test_services\test_production_schema.py::TestProductionDateValidator::test_parse_mm_dd_format FAILED [ 87%]
backend\tests\test_services\test_production_schema.py::TestProductionDateValidator::test_parse_mm_slash_dd_format FAILED [ 87%]
backend\tests\test_services\test_production_schema.py::TestProductionDateValidator::test_parse_full_date_format PASSED [ 88%]
backend\tests\test_services\test_production_schema.py::TestProductionDateValidator::test_parse_date_object PASSED [ 88%]
backend\tests\test_services\test_production_schema.py::TestProductionDateValidator::test_target_qty_alias PASSED [ 89%]
backend\tests\test_services\test_production_schema.py::TestProductionDateValidator::test_planned_qty_direct PASSED [ 89%]
backend\tests\test_services\test_production_schema.py::TestProductionDateValidator::test_invalid_date_format PASSED [ 89%]
backend\tests\test_services\test_production_schema.py::TestProductionDateValidator::test_optional_fields PASSED [ 90%]
backend\tests\test_services\test_production_schema.py::TestProductionDateValidator::test_default_values PASSED [ 90%]
backend\tests\test_services\test_production_schema.py::TestProductionDateValidator::test_edge_case_dates FAILED [ 91%]
backend\tests\test_timezone_chaos.py::test_timezone_chaos_midnight_boundary PASSED [ 91%]
backend\tests\test_widget_judge.py::test_judge_workforce_integrity_and_scope ERROR [ 92%]
backend\tests\test_widget_judge.py::test_judge_overview_timezone_and_scope ERROR [ 92%]
backend\tests\test_widget_judge.py::test_judge_no_fake_simulation ERROR  [ 92%]
backend\tests\unit\services\ingestion\test_date_profiler.py::TestDetectColumnFormat::test_detects_iso_when_last_exceeds_12 PASSED [ 93%]
backend\tests\unit\services\ingestion\test_date_profiler.py::TestDetectColumnFormat::test_detects_swap_when_middle_exceeds_12 PASSED [ 93%]
backend\tests\unit\services\ingestion\test_date_profiler.py::TestDetectColumnFormat::test_early_exit_on_first_proof PASSED [ 94%]
backend\tests\unit\services\ingestion\test_date_profiler.py::TestDetectColumnFormat::test_ambiguous_when_all_values_under_12 PASSED [ 94%]
backend\tests\unit\services\ingestion\test_date_profiler.py::TestDetectColumnFormat::test_single_ambiguous_value PASSED [ 94%]
backend\tests\unit\services\ingestion\test_date_profiler.py::TestDetectColumnFormat::test_impossible_date_both_exceed_12 PASSED [ 95%]
backend\tests\unit\services\ingestion\test_date_profiler.py::TestDetectColumnFormat::test_mixed_constraint_violations PASSED [ 95%]
backend\tests\unit\services\ingestion\test_date_profiler.py::TestDetectColumnFormat::test_february_30_invalid PASSED [ 96%]
backend\tests\unit\services\ingestion\test_date_profiler.py::TestDetectColumnFormat::test_empty_list PASSED [ 96%]
backend\tests\unit\services\ingestion\test_date_profiler.py::TestDetectColumnFormat::test_none_values_skipped PASSED [ 97%]
backend\tests\unit\services\ingestion\test_date_profiler.py::TestDetectColumnFormat::test_non_date_strings_skipped PASSED [ 97%]
backend\tests\unit\services\ingestion\test_date_profiler.py::TestDetectColumnFormat::test_slash_separator PASSED [ 97%]
backend\tests\unit\services\ingestion\test_date_profiler.py::TestDetectColumnFormat::test_dot_separator PASSED [ 98%]
backend\tests\unit\services\ingestion\test_date_profiler.py::TestDetectColumnFormat::test_mixed_separators PASSED [ 98%]
backend\tests\unit\services\ingestion\test_date_profiler.py::TestDetectColumnFormat::test_respects_max_sample PASSED [ 99%]
backend\tests\unit\services\ingestion\test_date_profiler.py::TestProfileDateColumn::test_returns_dict_with_expected_keys PASSED [ 99%]
backend\tests\unit\services\ingestion\test_date_profiler.py::TestProfileDateColumn::test_profile_matches_detect_result PASSED [100%]

=================================== ERRORS ====================================
________________ ERROR at setup of test_list_members_as_owner _________________
E   AttributeError: type object 'UserRole' has no attribute 'MANAGER'
__________ ERROR at setup of test_list_members_as_manager_forbidden ___________
E   AttributeError: type object 'UserRole' has no attribute 'MANAGER'
_________________ ERROR at setup of test_assign_user_to_line __________________
E   AttributeError: type object 'UserRole' has no attribute 'MANAGER'
__________________ ERROR at setup of test_remove_user_scope ___________________
E   AttributeError: type object 'UserRole' has no attribute 'MANAGER'
_____________ ERROR at setup of test_cannot_assign_cross_org_user _____________
E   AttributeError: type object 'UserRole' has no attribute 'MANAGER'
__________ ERROR at setup of test_e2e_excel_ingestion_and_dashboard ___________
E   sqlite3.IntegrityError: NOT NULL constraint failed: data_sources.factory_id

The above exception was the direct cause of the following exception:
E   sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: data_sources.factory_id
    [SQL: INSERT INTO data_sources (factory_id, name, code, target_operators, target_efficiency_pct, specialty, supervisor_id, production_line_id, source_name, description, time_column, time_format, parent_data_source_id, is_segment, date_range_start, date_range_end, is_active, id, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
    [parameters: (None, None, None, None, None, None, None, 'e53e062f-791e-411c-a5e0-46511e922741', 'Excel Upload (Verifiable)', 'E2E Test Source for demo@linesight.io', 'production_date', None, None, 0, None, None, 1, '774c2478-0825-4375-b663-fd644e6c667f', '2026-02-15 15:39:46.296310', '2026-02-15 15:39:46.296314')]
    (Background on this error at: https://sqlalche.me/e/20/gkpj)
__________________ ERROR at setup of test_edit_configuration __________________
E   NameError: name 'ProductionLine' is not defined
_________________ ERROR at setup of test_view_uploaded_files __________________
E   NameError: name 'ProductionLine' is not defined
_______________ ERROR at setup of test_upload_history_isolation _______________
E   NameError: name 'ProductionLine' is not defined
____________ ERROR at setup of test_upload_history_simple_endpoint ____________
E   NameError: name 'ProductionLine' is not defined
_________ ERROR at setup of test_value_preservation_through_pipeline __________
E   NameError: name 'ProductionLine' is not defined
_________________ ERROR at setup of test_date_format_handling _________________
E   NameError: name 'ProductionLine' is not defined
_______________ ERROR at setup of test_efficiency_normalization _______________
E   NameError: name 'ProductionLine' is not defined
____________________ ERROR at setup of test_null_handling _____________________
E   NameError: name 'ProductionLine' is not defined
_________ ERROR at setup of test_data_integrity_across_multiple_rows __________
E   NameError: name 'ProductionLine' is not defined
_______________ ERROR at setup of test_style_and_order_creation _______________
E   NameError: name 'ProductionLine' is not defined
______________ ERROR at setup of test_duplicate_upload_handling _______________
E   NameError: name 'ProductionLine' is not defined
________ ERROR at setup of test_multiple_widgets_receive_correct_data _________
E   NameError: name 'ProductionLine' is not defined
________________ ERROR at setup of test_invalid_data_handling _________________
E   NameError: name 'ProductionLine' is not defined
____________ ERROR at setup of test_analytics_sum_matches_database ____________
E   NameError: name 'ProductionLine' is not defined
___________________ ERROR at setup of test_get_data_source ____________________
E   AssertionError: Failed to create test data source: {"detail":"Not Found"}
    assert 404 == 201
     +  where 404 = <Response [404 Not Found]>.status_code
---------------------------- Captured stdout setup ----------------------------
{"timestamp": "2026-02-15T15:39:58.473516Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/datasources \"HTTP/1.1 404 Not Found\""}
----------------------------- Captured log setup ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/datasources "HTTP/1.1 404 Not Found"
_______________ ERROR at setup of test_get_data_source_by_line ________________
E   AssertionError: Failed to create test data source: {"detail":"Not Found"}
    assert 404 == 201
     +  where 404 = <Response [404 Not Found]>.status_code
---------------------------- Captured stdout setup ----------------------------
{"timestamp": "2026-02-15T15:39:58.790717Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/datasources \"HTTP/1.1 404 Not Found\""}
----------------------------- Captured log setup ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/datasources "HTTP/1.1 404 Not Found"
________________ ERROR at setup of test_update_schema_mapping _________________
E   AssertionError: Failed to create test data source: {"detail":"Not Found"}
    assert 404 == 201
     +  where 404 = <Response [404 Not Found]>.status_code
---------------------------- Captured stdout setup ----------------------------
{"timestamp": "2026-02-15T15:39:59.156110Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/datasources \"HTTP/1.1 404 Not Found\""}
----------------------------- Captured log setup ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/datasources "HTTP/1.1 404 Not Found"
__________ ERROR at setup of test_create_duplicate_data_source_fails __________
E   AssertionError: Failed to create test data source: {"detail":"Not Found"}
    assert 404 == 201
     +  where 404 = <Response [404 Not Found]>.status_code
---------------------------- Captured stdout setup ----------------------------
{"timestamp": "2026-02-15T15:39:59.506650Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/datasources \"HTTP/1.1 404 Not Found\""}
----------------------------- Captured log setup ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/datasources "HTTP/1.1 404 Not Found"
____________ ERROR at setup of test_get_datasource_by_line_exists _____________
E   NameError: name 'ProductionLine' is not defined
_____________ ERROR at setup of test_get_datasource_by_line_none ______________
E   NameError: name 'ProductionLine' is not defined
_________ ERROR at setup of test_get_datasource_cross_line_isolation __________
E   NameError: name 'ProductionLine' is not defined
__________________ ERROR at setup of test_update_datasource ___________________
E   NameError: name 'ProductionLine' is not defined
__________ ERROR at setup of test_demo_full_pipeline_with_excel_file __________
E   NameError: name 'ProductionLine' is not defined
______________ ERROR at setup of test_demo_data_values_integrity ______________
E   NameError: name 'ProductionLine' is not defined
______________ ERROR at setup of test_dry_run_preview_structure _______________
E   ImportError: cannot import name 'ProductionLine' from 'app.models.factory' (C:\Users\19803\Projects\FactoryExcelManager\backend\app\models\factory.py)
______________ ERROR at setup of test_date_auto_fixing_detection ______________
E   ImportError: cannot import name 'ProductionLine' from 'app.models.factory' (C:\Users\19803\Projects\FactoryExcelManager\backend\app\models\factory.py)
____________ ERROR at setup of test_efficiency_percentage_cleaning ____________
E   ImportError: cannot import name 'ProductionLine' from 'app.models.factory' (C:\Users\19803\Projects\FactoryExcelManager\backend\app\models\factory.py)
________________ ERROR at setup of test_decimal_field_handling ________________
E   ImportError: cannot import name 'ProductionLine' from 'app.models.factory' (C:\Users\19803\Projects\FactoryExcelManager\backend\app\models\factory.py)
________________ ERROR at setup of test_integer_field_cleaning ________________
E   ImportError: cannot import name 'ProductionLine' from 'app.models.factory' (C:\Users\19803\Projects\FactoryExcelManager\backend\app\models\factory.py)
______________ ERROR at setup of test_column_mapping_application ______________
E   ImportError: cannot import name 'ProductionLine' from 'app.models.factory' (C:\Users\19803\Projects\FactoryExcelManager\backend\app\models\factory.py)
_____________ ERROR at setup of test_overall_status_with_warnings _____________
E   ImportError: cannot import name 'ProductionLine' from 'app.models.factory' (C:\Users\19803\Projects\FactoryExcelManager\backend\app\models\factory.py)
_______________ ERROR at setup of test_overall_status_all_valid _______________
E   ImportError: cannot import name 'ProductionLine' from 'app.models.factory' (C:\Users\19803\Projects\FactoryExcelManager\backend\app\models\factory.py)
___________ ERROR at setup of test_promotion_after_dry_run_approval ___________
E   ImportError: cannot import name 'ProductionLine' from 'app.models.factory' (C:\Users\19803\Projects\FactoryExcelManager\backend\app\models\factory.py)
_________ ERROR at setup of test_dry_run_with_missing_schema_mapping __________
E   ImportError: cannot import name 'ProductionLine' from 'app.models.factory' (C:\Users\19803\Projects\FactoryExcelManager\backend\app\models\factory.py)
______________ ERROR at setup of test_dry_run_limits_to_20_rows _______________
E   ImportError: cannot import name 'ProductionLine' from 'app.models.factory' (C:\Users\19803\Projects\FactoryExcelManager\backend\app\models\factory.py)
____________ ERROR at setup of test_raw_data_preserved_in_preview _____________
E   ImportError: cannot import name 'ProductionLine' from 'app.models.factory' (C:\Users\19803\Projects\FactoryExcelManager\backend\app\models\factory.py)
_______________ ERROR at setup of test_preview_dry_run_endpoint _______________
E   ImportError: cannot import name 'ProductionLine' from 'app.models.factory' (C:\Users\19803\Projects\FactoryExcelManager\backend\app\models\factory.py)
________________ ERROR at setup of test_quality_data_promotion ________________
E   NameError: name 'ProductionLine' is not defined
_________________ ERROR at setup of test_line_quota_enforced __________________
E   sqlite3.IntegrityError: NOT NULL constraint failed: factories.code

The above exception was the direct cause of the following exception:
E   sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: factories.code
    [SQL: INSERT INTO factories (organization_id, name, code, country, city, address, timezone, total_lines, total_workers, daily_capacity_units, certifications, locale, is_active, id, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
    [parameters: ('9e91cb8f-380b-4da1-b6ef-a3d5d399529a', 'Test Factory', None, 'US', None, None, 'UTC', None, None, None, None, 'en-US', 1, 'd783f172-e16a-4891-acf5-3dd3329e1f76', '2026-02-15 15:40:17.729155', '2026-02-15 15:40:17.729158')]
    (Background on this error at: https://sqlalche.me/e/20/gkpj)
________________ ERROR at setup of test_quota_status_endpoint _________________
E   sqlite3.IntegrityError: NOT NULL constraint failed: factories.code

The above exception was the direct cause of the following exception:
E   sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: factories.code
    [SQL: INSERT INTO factories (organization_id, name, code, country, city, address, timezone, total_lines, total_workers, daily_capacity_units, certifications, locale, is_active, id, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
    [parameters: ('d8dfe675-d172-4cb3-9b34-c99cb423a510', 'Test Factory', None, 'US', None, None, 'UTC', None, None, None, None, 'en-US', 1, '240705fc-b092-4db1-a991-13e12c48b4c9', '2026-02-15 15:40:18.358349', '2026-02-15 15:40:18.358352')]
    (Background on this error at: https://sqlalche.me/e/20/gkpj)
_________ ERROR at setup of test_judge_workforce_integrity_and_scope __________
E   NameError: name 'Factory' is not defined
__________ ERROR at setup of test_judge_overview_timezone_and_scope ___________
E   NameError: name 'Factory' is not defined
_______________ ERROR at setup of test_judge_no_fake_simulation _______________
E   NameError: name 'Factory' is not defined
================================== FAILURES ===================================
E   TypeError: 'line_id' is an invalid keyword argument for ProductionRun
---------------------------- Captured stdout call -----------------------------

DEBUG: Starting test_hourly_production_no_events_returns_zeros
C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\orm\decl_base.py:2179: TypeError: 'line_id' is an invalid keyword argument for ProductionRun
E   ImportError: cannot import name 'ProductionLine' from 'app.models.factory' (C:\Users\19803\Projects\FactoryExcelManager\backend\app\models\factory.py)
---------------------------- Captured stdout call -----------------------------

DEBUG: Starting test_midnight_boundary_respects_timezone
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\api\test_analytics_flaws.py:84: ImportError: cannot import name 'ProductionLine' from 'app.models.factory' (C:\Users\19803\Projects\FactoryExcelManager\backend\app\models\factory.py)
E   AssertionError: Failed to create factory: {"detail":[{"type":"value_error","loc":["body","country"],"msg":"Value error, Country must be a 2-letter ISO 3166-1 alpha-2 code (e.g., US, EG)","input":"Japan","ctx":{"error":{}}}]}
    assert 422 == 201
     +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:39:41.598382Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/factories \"HTTP/1.1 422 Unprocessable Entity\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/factories "HTTP/1.1 422 Unprocessable Entity"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\api\v1\test_factory_settings.py:66: AssertionError: Failed to create factory: {"detail":[{"type":"value_error","loc":["body","country"],"msg":"Value error, Country must be a 2-letter ISO 3166-1 alpha-2 code (e.g., US, EG)","input":"Japan","ctx":{"error":{}}}]}
E   assert 200 == 422
     +  where 200 = <Response [200 OK]>.status_code
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:39:45.943651Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: PATCH http://test/api/v1/users/me \"HTTP/1.1 200 OK\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: PATCH http://test/api/v1/users/me "HTTP/1.1 200 OK"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\api\v1\test_users.py:123: assert 200 == 422
E   sqlite3.IntegrityError: NOT NULL constraint failed: data_sources.factory_id

The above exception was the direct cause of the following exception:
E   sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: data_sources.factory_id
    [SQL: INSERT INTO data_sources (factory_id, name, code, target_operators, target_efficiency_pct, specialty, supervisor_id, production_line_id, source_name, description, time_column, time_format, parent_data_source_id, is_segment, date_range_start, date_range_end, is_active, id, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
    [parameters: (None, None, None, None, None, None, None, '2986ffd7-a402-465a-bf27-6db8ab4e5143', 'Test Source', None, None, None, None, 0, None, None, 1, '95d67e2a-caa6-4ed4-8112-f0145a3cf159', '2026-02-15 15:39:49.056070', '2026-02-15 15:39:49.056073')]
    (Background on this error at: https://sqlalche.me/e/20/gkpj)
C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\aiosqlite\core.py:63: sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: data_sources.factory_id
E   AttributeError: type object 'UserRole' has no attribute 'ADMIN'
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_auth.py:31: AttributeError: type object 'UserRole' has no attribute 'ADMIN'
E   AttributeError: type object 'UserRole' has no attribute 'ADMIN'
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_auth.py:67: AttributeError: type object 'UserRole' has no attribute 'ADMIN'
E   assert 422 == 201
     +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:39:52.563117Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/factories \"HTTP/1.1 422 Unprocessable Entity\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/factories "HTTP/1.1 422 Unprocessable Entity"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_dashboard_creation_flow.py:55: assert 422 == 201
E   assert 422 == 403
     +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:39:52.896569Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/factories \"HTTP/1.1 422 Unprocessable Entity\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/factories "HTTP/1.1 422 Unprocessable Entity"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_dashboard_creation_flow.py:241: assert 422 == 403
E   KeyError: 'id'
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:39:53.245942Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/factories \"HTTP/1.1 422 Unprocessable Entity\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/factories "HTTP/1.1 422 Unprocessable Entity"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_dashboard_creation_flow.py:282: KeyError: 'id'
E   assert 422 == 201
     +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:39:53.590810Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/factories \"HTTP/1.1 422 Unprocessable Entity\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/factories "HTTP/1.1 422 Unprocessable Entity"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_dashboard_creation_flow.py:356: assert 422 == 201
E   AssertionError: assert 0.0 > 1.0
     +  where 0.0 = float('0')
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:39:54.343776Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: GET http://test/api/v1/analytics/dhu \"HTTP/1.1 200 OK\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: GET http://test/api/v1/analytics/dhu "HTTP/1.1 200 OK"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_dashboard_widgets.py:73: AssertionError: assert 0.0 > 1.0
E   AssertionError: assert 'On Track' in ['In Progress', 'In Progress']
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:39:54.688920Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: GET http://test/api/v1/analytics/production/styles \"HTTP/1.1 200 OK\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: GET http://test/api/v1/analytics/production/styles "HTTP/1.1 200 OK"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_dashboard_widgets.py:170: AssertionError: assert 'On Track' in ['In Progress', 'In Progress']
E   AssertionError: Expected 201, got 404: {"detail":"Not Found"}
    assert 404 == 201
     +  where 404 = <Response [404 Not Found]>.status_code
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:39:58.156140Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/datasources \"HTTP/1.1 404 Not Found\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/datasources "HTTP/1.1 404 Not Found"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_datasource.py:35: AssertionError: Expected 201, got 404: {"detail":"Not Found"}
E   sqlite3.IntegrityError: NOT NULL constraint failed: factories.code

The above exception was the direct cause of the following exception:
E   sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: factories.code
    [SQL: INSERT INTO factories (organization_id, name, code, country, city, address, timezone, total_lines, total_workers, daily_capacity_units, certifications, locale, is_active, id, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
    [parameters: ('05fa2a0b-503f-4d84-96e2-1c68aae2f745', 'Factory Cascade Test Line', None, 'US', None, None, 'UTC', None, None, None, None, 'en-US', 1, '4afd39f8-7490-4257-a112-646b20a780c7', '2026-02-15 15:40:00.896976', '2026-02-15 15:40:00.896978')]
    (Background on this error at: https://sqlalche.me/e/20/gkpj)
C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\aiosqlite\core.py:63: sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: factories.code
E   sqlite3.IntegrityError: NOT NULL constraint failed: factories.code

The above exception was the direct cause of the following exception:
E   sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: factories.code
    [SQL: INSERT INTO factories (organization_id, name, code, country, city, address, timezone, total_lines, total_workers, daily_capacity_units, certifications, locale, is_active, id, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
    [parameters: ('3dfdde9a-c3f2-43f2-81dc-4ae108223fab', 'Factory History Test Line', None, 'US', None, None, 'UTC', None, None, None, None, 'en-US', 1, '690cfc6b-8bff-4277-962d-2656f67317fc', '2026-02-15 15:40:01.256783', '2026-02-15 15:40:01.256787')]
    (Background on this error at: https://sqlalche.me/e/20/gkpj)
C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\aiosqlite\core.py:63: sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: factories.code
E   sqlite3.IntegrityError: NOT NULL constraint failed: factories.code

The above exception was the direct cause of the following exception:
E   sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: factories.code
    [SQL: INSERT INTO factories (organization_id, name, code, country, city, address, timezone, total_lines, total_workers, daily_capacity_units, certifications, locale, is_active, id, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
    [parameters: ('225009c2-d6f6-4dff-88ce-27913570c243', 'Factory Missing File Line', None, 'US', None, None, 'UTC', None, None, None, None, 'en-US', 1, '9a2d84a8-d723-414b-9269-0cffb0b50feb', '2026-02-15 15:40:01.599094', '2026-02-15 15:40:01.599096')]
    (Background on this error at: https://sqlalche.me/e/20/gkpj)
C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\aiosqlite\core.py:63: sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: factories.code
E   sqlite3.IntegrityError: NOT NULL constraint failed: factories.code

The above exception was the direct cause of the following exception:
E   sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: factories.code
    [SQL: INSERT INTO factories (organization_id, name, code, country, city, address, timezone, total_lines, total_workers, daily_capacity_units, certifications, locale, is_active, id, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
    [parameters: ('61e0691c-103b-4cba-a598-69876a7c4aac', 'Factory Restricted', None, 'US', None, None, 'UTC', None, None, None, None, 'en-US', 1, '5a9484cd-7668-4b55-bdc9-5074ad5e3716', '2026-02-15 15:40:01.712140', '2026-02-15 15:40:01.712143')]
    (Background on this error at: https://sqlalche.me/e/20/gkpj)
C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\aiosqlite\core.py:63: sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: factories.code
E   sqlite3.IntegrityError: NOT NULL constraint failed: factories.code

The above exception was the direct cause of the following exception:
E   sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: factories.code
    [SQL: INSERT INTO factories (organization_id, name, code, country, city, address, timezone, total_lines, total_workers, daily_capacity_units, certifications, locale, is_active, id, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
    [parameters: ('e39c3a6a-c954-4025-bea1-aee5b49b5187', 'Factory Cleanup Line', None, 'US', None, None, 'UTC', None, None, None, None, 'en-US', 1, '0412cbf5-1c76-418e-b24e-2a6b21d974d7', '2026-02-15 15:40:02.053925', '2026-02-15 15:40:02.053927')]
    (Background on this error at: https://sqlalche.me/e/20/gkpj)
C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\aiosqlite\core.py:63: sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: factories.code
E   sqlite3.IntegrityError: NOT NULL constraint failed: factories.code

The above exception was the direct cause of the following exception:
E   sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: factories.code
    [SQL: INSERT INTO factories (organization_id, name, code, country, city, address, timezone, total_lines, total_workers, daily_capacity_units, certifications, locale, is_active, id, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
    [parameters: ('313bd291-53d3-4e6e-87dd-4983ed258f0c', 'Factory Org A Line', None, 'US', None, None, 'UTC', None, None, None, None, 'en-US', 1, 'cc34b5ff-4043-4afd-8085-3e7b8ed685f9', '2026-02-15 15:40:02.168224', '2026-02-15 15:40:02.168226')]
    (Background on this error at: https://sqlalche.me/e/20/gkpj)
C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\aiosqlite\core.py:63: sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: factories.code
E   sqlite3.IntegrityError: NOT NULL constraint failed: factories.code

The above exception was the direct cause of the following exception:
E   sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: factories.code
    [SQL: INSERT INTO factories (organization_id, name, code, country, city, address, timezone, total_lines, total_workers, daily_capacity_units, certifications, locale, is_active, id, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
    [parameters: ('e72fcffa-69c2-4ce3-8efb-086cc58c0caf', 'Factory Audit Line', None, 'US', None, None, 'UTC', None, None, None, None, 'en-US', 1, 'e004ea95-d5b3-4d4e-b1e5-c3eb8936870a', '2026-02-15 15:40:02.527255', '2026-02-15 15:40:02.527257')]
    (Background on this error at: https://sqlalche.me/e/20/gkpj)
C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\aiosqlite\core.py:63: sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: factories.code
E   assert 422 == 201
     +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:04.785460Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/factories \"HTTP/1.1 422 Unprocessable Entity\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/factories "HTTP/1.1 422 Unprocessable Entity"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_error_handling.py:62: assert 422 == 201
E   NameError: name 'ProductionLine' is not defined
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_excel_to_widget_integrity.py:56: NameError: name 'ProductionLine' is not defined
E   NameError: name 'ProductionLine' is not defined
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_excel_to_widget_integrity.py:196: NameError: name 'ProductionLine' is not defined
E   assert 422 == 201
     +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:05.714641Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/factories \"HTTP/1.1 422 Unprocessable Entity\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/factories "HTTP/1.1 422 Unprocessable Entity"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_factories.py:21: assert 422 == 201
E   assert 0 >= 1
     +  where 0 = len([])
     +    where [] = json()
     +      where json = <Response [200 OK]>.json
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:06.073705Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/factories \"HTTP/1.1 422 Unprocessable Entity\""}
{"timestamp": "2026-02-15T15:40:06.078204Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: GET http://test/api/v1/factories \"HTTP/1.1 200 OK\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/factories "HTTP/1.1 422 Unprocessable Entity"
INFO     httpx:_client.py:1740 HTTP Request: GET http://test/api/v1/factories "HTTP/1.1 200 OK"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_factories.py:39: assert 0 >= 1
E   assert 422 == 201
     +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:06.391207Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/factories \"HTTP/1.1 422 Unprocessable Entity\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/factories "HTTP/1.1 422 Unprocessable Entity"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_factories.py:50: assert 422 == 201
E   AssertionError: assert 10.0 == 100.0
     +  where 10.0 = float('10.0')
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:06.705295Z", "level": "INFO", "logger": "app.api.v1.endpoints.analytics", "message": "[DIAG] get_overview_stats called with line_id=None"}
{"timestamp": "2026-02-15T15:40:06.713953Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: GET http://test/api/v1/analytics/overview \"HTTP/1.1 200 OK\""}
------------------------------ Captured log call ------------------------------
INFO     app.api.v1.endpoints.analytics:analytics.py:73 [DIAG] get_overview_stats called with line_id=None
INFO     httpx:_client.py:1740 HTTP Request: GET http://test/api/v1/analytics/overview "HTTP/1.1 200 OK"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_fallback_logic.py:107: AssertionError: assert 10.0 == 100.0
E   AssertionError: assert 0.0 == 100.0
     +  where 0.0 = float('0.0')
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:07.359779Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: GET http://test/api/v1/analytics/sam-performance \"HTTP/1.1 200 OK\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: GET http://test/api/v1/analytics/sam-performance "HTTP/1.1 200 OK"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_fallback_logic.py:145: AssertionError: assert 0.0 == 100.0
E   assert 404 == 200
     +  where 404 = <Response [404 Not Found]>.status_code
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:07.670995Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: GET http://test/api/v1/analytics/hourly-production \"HTTP/1.1 404 Not Found\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: GET http://test/api/v1/analytics/hourly-production "HTTP/1.1 404 Not Found"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_fallback_logic.py:158: assert 404 == 200
E   assert 404 == 200
     +  where 404 = <Response [404 Not Found]>.status_code
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:08.005906Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: GET http://test/api/v1/analytics/hourly-production \"HTTP/1.1 404 Not Found\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: GET http://test/api/v1/analytics/hourly-production "HTTP/1.1 404 Not Found"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_individual_widgets.py:190: assert 404 == 200
E   AssertionError: assert 6.0 == 90.0
     +  where 6.0 = float('6.0')
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:08.379434Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: GET http://test/api/v1/analytics/sam-performance \"HTTP/1.1 200 OK\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: GET http://test/api/v1/analytics/sam-performance "HTTP/1.1 200 OK"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_individual_widgets.py:221: AssertionError: assert 6.0 == 90.0
E   AttributeError: type object 'ProductionEvent' has no attribute 'line_id'
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:08.728009Z", "level": "ERROR", "logger": "app.main", "message": "Unhandled exception: type object 'ProductionEvent' has no attribute 'line_id'", "exception": "Traceback (most recent call last):\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\middleware\\errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\middleware\\cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\middleware\\exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\middleware\\asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\routing.py\", line 115, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\routing.py\", line 101, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\routing.py\", line 355, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<3 lines>...\n    )\n    ^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\routing.py\", line 243, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\app\\api\\v1\\endpoints\\analytics.py\", line 948, in get_workforce_stats\n    effective_date = await prod_repo.get_effective_date(line_id)\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\app\\repositories\\production_repo.py\", line 169, in get_effective_date\n    check_events = check_events.where(ProductionEvent.line_id == line_id)\n                                      ^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: type object 'ProductionEvent' has no attribute 'line_id'"}
------------------------------ Captured log call ------------------------------
ERROR    app.main:main.py:100 Unhandled exception: type object 'ProductionEvent' has no attribute 'line_id'
Traceback (most recent call last):
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\app\api\v1\endpoints\analytics.py", line 948, in get_workforce_stats
    effective_date = await prod_repo.get_effective_date(line_id)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\app\repositories\production_repo.py", line 169, in get_effective_date
    check_events = check_events.where(ProductionEvent.line_id == line_id)
                                      ^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: type object 'ProductionEvent' has no attribute 'line_id'
C:\Users\19803\Projects\FactoryExcelManager\backend\app\repositories\production_repo.py:169: AttributeError: type object 'ProductionEvent' has no attribute 'line_id'
E   AssertionError: assert 0.0 == 2.5
     +  where 0.0 = float('0')
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:09.116528Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: GET http://test/api/v1/analytics/dhu?days=7 \"HTTP/1.1 200 OK\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: GET http://test/api/v1/analytics/dhu?days=7 "HTTP/1.1 200 OK"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_individual_widgets.py:281: AssertionError: assert 0.0 == 2.5
E   assert None is not None
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:09.507684Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: GET http://test/api/v1/analytics/speed-quality \"HTTP/1.1 200 OK\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: GET http://test/api/v1/analytics/speed-quality "HTTP/1.1 200 OK"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_individual_widgets.py:308: assert None is not None
E   NameError: name 'ProductionLine' is not defined
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_ingestion_deduplication.py:35: NameError: name 'ProductionLine' is not defined
E   NameError: name 'ProductionLine' is not defined
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_ingestion_deduplication.py:86: NameError: name 'ProductionLine' is not defined
E   NameError: name 'ProductionLine' is not defined
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_ingestion_deduplication.py:153: NameError: name 'ProductionLine' is not defined
E   NameError: name 'ProductionLine' is not defined
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_ingestion_flow.py:45: NameError: name 'ProductionLine' is not defined
E   NameError: name 'ProductionLine' is not defined
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_ingestion_flow.py:249: NameError: name 'ProductionLine' is not defined
E   ValueError: Canonical mapping validation failed:
    Canonical field 'line_id' maps to missing attribute 'line_id' in model ProductionRun
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:11.739618Z", "level": "WARNING", "logger": "app.services.matching.validation", "message": "Canonical field 'start_time' is not registered in CANONICAL_MODEL_MAPPING for validation."}
{"timestamp": "2026-02-15T15:40:11.739751Z", "level": "WARNING", "logger": "app.services.matching.validation", "message": "Canonical field 'end_time' is not registered in CANONICAL_MODEL_MAPPING for validation."}
{"timestamp": "2026-02-15T15:40:11.739798Z", "level": "WARNING", "logger": "app.services.matching.validation", "message": "Canonical field 'downtime_reason' is not registered in CANONICAL_MODEL_MAPPING for validation."}
{"timestamp": "2026-02-15T15:40:11.739839Z", "level": "ERROR", "logger": "app.services.matching.validation", "message": "Canonical field 'line_id' maps to missing attribute 'line_id' in model ProductionRun"}
------------------------------ Captured log call ------------------------------
WARNING  app.services.matching.validation:validation.py:63 Canonical field 'start_time' is not registered in CANONICAL_MODEL_MAPPING for validation.
WARNING  app.services.matching.validation:validation.py:63 Canonical field 'end_time' is not registered in CANONICAL_MODEL_MAPPING for validation.
WARNING  app.services.matching.validation:validation.py:63 Canonical field 'downtime_reason' is not registered in CANONICAL_MODEL_MAPPING for validation.
ERROR    app.services.matching.validation:validation.py:73 Canonical field 'line_id' maps to missing attribute 'line_id' in model ProductionRun
C:\Users\19803\Projects\FactoryExcelManager\backend\app\services\matching\validation.py:77: ValueError: Canonical mapping validation failed:
E   sqlite3.IntegrityError: NOT NULL constraint failed: factories.locale

The above exception was the direct cause of the following exception:
E   sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: factories.locale
    [SQL: 
            INSERT INTO factories (id, organization_id, name, code, is_active, country, timezone, created_at, updated_at)
            VALUES ('e46e8c97-af16-4d9c-a31c-56c72272a6c8', '9485daba-355a-487e-98da-595b85300ae9', 'Reset Factory', 'RF-001', 1, 'US', 'UTC', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
        ]
    (Background on this error at: https://sqlalche.me/e/20/gkpj)
C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\aiosqlite\core.py:63: sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: factories.locale
E   sqlite3.IntegrityError: NOT NULL constraint failed: factories.locale

The above exception was the direct cause of the following exception:
E   sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: factories.locale
    [SQL: 
            INSERT INTO factories (id, organization_id, name, code, is_active, country, timezone, created_at, updated_at)
            VALUES ('b587f9de-c262-4a70-b9a2-cdcc91bf07fb', 'f969b572-185a-478c-81eb-b8c322fe85b1', 'History Factory', 'HF-001', 1, 'US', 'UTC', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
        ]
    (Background on this error at: https://sqlalche.me/e/20/gkpj)
C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\aiosqlite\core.py:63: sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: factories.locale
E   NameError: name 'ProductionLine' is not defined
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_preview.py:30: NameError: name 'ProductionLine' is not defined
E   NameError: name 'ProductionLine' is not defined
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_preview.py:90: NameError: name 'ProductionLine' is not defined
E   TypeError: 'line_id' is an invalid keyword argument for ProductionRun
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:15.557201Z", "level": "ERROR", "logger": "app.main", "message": "Unhandled exception: 'line_id' is an invalid keyword argument for ProductionRun", "exception": "Traceback (most recent call last):\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\middleware\\errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\middleware\\cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\middleware\\exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\middleware\\asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\routing.py\", line 115, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\routing.py\", line 101, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\routing.py\", line 355, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<3 lines>...\n    )\n    ^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\routing.py\", line 243, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\app\\api\\v1\\endpoints\\production.py\", line 180, in create_run\n    return await service.create_run(run_in)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\app\\services\\production\\production_service.py\", line 160, in create_run\n    run = await self.repo.create_run(run_data)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\app\\repositories\\production_repo.py\", line 331, in create_run\n    run = ProductionRun(**run_data)\n  File \"<string>\", line 4, in __init__\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\state.py\", line 596, in _initialize_instance\n    with util.safe_reraise():\n         ~~~~~~~~~~~~~~~~~^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 224, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\state.py\", line 594, in _initialize_instance\n    manager.original_init(*mixed[1:], **kwargs)\n    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\decl_base.py\", line 2179, in _declarative_constructor\n    raise TypeError(\n        \"%r is an invalid keyword argument for %s\" % (k, cls_.__name__)\n    )\nTypeError: 'line_id' is an invalid keyword argument for ProductionRun"}
------------------------------ Captured log call ------------------------------
ERROR    app.main:main.py:100 Unhandled exception: 'line_id' is an invalid keyword argument for ProductionRun
Traceback (most recent call last):
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\app\api\v1\endpoints\production.py", line 180, in create_run
    return await service.create_run(run_in)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\app\services\production\production_service.py", line 160, in create_run
    run = await self.repo.create_run(run_data)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\app\repositories\production_repo.py", line 331, in create_run
    run = ProductionRun(**run_data)
  File "<string>", line 4, in __init__
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\orm\state.py", line 596, in _initialize_instance
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\orm\state.py", line 594, in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\orm\decl_base.py", line 2179, in _declarative_constructor
    raise TypeError(
        "%r is an invalid keyword argument for %s" % (k, cls_.__name__)
    )
TypeError: 'line_id' is an invalid keyword argument for ProductionRun
C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\orm\decl_base.py:2179: TypeError: 'line_id' is an invalid keyword argument for ProductionRun
E   NameError: name 'ProductionLine' is not defined
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_promotion.py:49: NameError: name 'ProductionLine' is not defined
E   assert 422 == 201
     +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:17.419195Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/factories \"HTTP/1.1 422 Unprocessable Entity\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/factories "HTTP/1.1 422 Unprocessable Entity"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_quota_enforcement.py:54: assert 422 == 201
E   assert 422 == 201
     +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:18.048790Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/factories \"HTTP/1.1 422 Unprocessable Entity\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/factories "HTTP/1.1 422 Unprocessable Entity"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_quota_enforcement.py:137: assert 422 == 201
E   assert 422 == 201
     +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:18.696163Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/factories \"HTTP/1.1 422 Unprocessable Entity\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/factories "HTTP/1.1 422 Unprocessable Entity"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_quota_enforcement.py:227: assert 422 == 201
E   assert 422 == 201
     +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:19.044389Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/factories \"HTTP/1.1 422 Unprocessable Entity\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/factories "HTTP/1.1 422 Unprocessable Entity"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_quota_enforcement.py:257: assert 422 == 201
E   assert 422 == 403
     +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:19.405325Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/factories \"HTTP/1.1 422 Unprocessable Entity\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/factories "HTTP/1.1 422 Unprocessable Entity"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_quota_enforcement.py:295: assert 422 == 403
E   assert 422 == 201
     +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:19.738526Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/factories \"HTTP/1.1 422 Unprocessable Entity\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/factories "HTTP/1.1 422 Unprocessable Entity"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_repro_500.py:40: assert 422 == 201
E   AssertionError: assert 'perfect_production.xlsx' in ['EdgeCase_Abbreviated_Headers.xlsx', 'EdgeCase_Ambiguous_Headers.xlsx', 'EdgeCase_Header_Synonyms.xlsx', 'EdgeCase_Header_Typos.xlsx', 'EdgeCase_Mixed_Data_Quality.xlsx', 'Feature_Quality_And_Blockers.xlsx', ...]
---------------------------- Captured stdout setup ----------------------------
{"timestamp": "2026-02-15T15:40:19.786993Z", "level": "INFO", "logger": "app.main", "message": "Starting LineSight v0.1.0"}
{"timestamp": "2026-02-15T15:40:19.787188Z", "level": "INFO", "logger": "app.main", "message": "Database: postgres:5434/linesight"}
{"timestamp": "2026-02-15T15:40:19.787269Z", "level": "INFO", "logger": "app.main", "message": "LLM Provider: deepseek"}
----------------------------- Captured log setup ------------------------------
INFO     app.main:main.py:37 Starting LineSight v0.1.0
INFO     app.main:main.py:38 Database: postgres:5434/linesight
INFO     app.main:main.py:39 LLM Provider: deepseek
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:19.789468Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Sample data directory: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data"}
{"timestamp": "2026-02-15T15:40:19.789651Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Directory exists: True"}
{"timestamp": "2026-02-15T15:40:19.790033Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "All files in directory: [WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/EdgeCase_Abbreviated_Headers.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/EdgeCase_Ambiguous_Headers.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/EdgeCase_Header_Synonyms.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/EdgeCase_Header_Typos.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/EdgeCase_Mixed_Data_Quality.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Feature_Quality_And_Blockers.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Historical_2025-10.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Historical_2025-11.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Historical_2025-12.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Historical_2026-01.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Legacy_Hourly_Floor_Tracker.csv'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Legacy_Style_Complexity_Log.csv'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Sequential_2025-01.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Sequential_2025-02.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Sequential_2025-03.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Standard_Clean_Small.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Standard_Master_Widget.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Unit_Ambiguous_Production.csv'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Unit_Ambiguous_Production.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Unit_Messy_Production.csv'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Unit_Messy_Production.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Unit_Perfect_Production.csv'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Unit_Perfect_Production.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Volume_90Day_Production.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Volume_DateRange_Production.xlsx')]"}
{"timestamp": "2026-02-15T15:40:19.790413Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found xlsx file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\EdgeCase_Abbreviated_Headers.xlsx"}
{"timestamp": "2026-02-15T15:40:19.790626Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found xlsx file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\EdgeCase_Ambiguous_Headers.xlsx"}
{"timestamp": "2026-02-15T15:40:19.790790Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found xlsx file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\EdgeCase_Header_Synonyms.xlsx"}
{"timestamp": "2026-02-15T15:40:19.790936Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found xlsx file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\EdgeCase_Header_Typos.xlsx"}
{"timestamp": "2026-02-15T15:40:19.791068Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found xlsx file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\EdgeCase_Mixed_Data_Quality.xlsx"}
{"timestamp": "2026-02-15T15:40:19.791193Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found xlsx file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\Feature_Quality_And_Blockers.xlsx"}
{"timestamp": "2026-02-15T15:40:19.791374Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found xlsx file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\Historical_2025-10.xlsx"}
{"timestamp": "2026-02-15T15:40:19.791585Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found xlsx file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\Historical_2025-11.xlsx"}
{"timestamp": "2026-02-15T15:40:19.791735Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found xlsx file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\Historical_2025-12.xlsx"}
{"timestamp": "2026-02-15T15:40:19.791868Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found xlsx file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\Historical_2026-01.xlsx"}
{"timestamp": "2026-02-15T15:40:19.792049Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found xlsx file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\Sequential_2025-01.xlsx"}
{"timestamp": "2026-02-15T15:40:19.792204Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found xlsx file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\Sequential_2025-02.xlsx"}
{"timestamp": "2026-02-15T15:40:19.792332Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found xlsx file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\Sequential_2025-03.xlsx"}
{"timestamp": "2026-02-15T15:40:19.792454Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found xlsx file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\Standard_Clean_Small.xlsx"}
{"timestamp": "2026-02-15T15:40:19.792574Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found xlsx file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\Standard_Master_Widget.xlsx"}
{"timestamp": "2026-02-15T15:40:19.792693Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found xlsx file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\Unit_Ambiguous_Production.xlsx"}
{"timestamp": "2026-02-15T15:40:19.792823Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found xlsx file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\Unit_Messy_Production.xlsx"}
{"timestamp": "2026-02-15T15:40:19.792950Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found xlsx file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\Unit_Perfect_Production.xlsx"}
{"timestamp": "2026-02-15T15:40:19.793069Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found xlsx file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\Volume_90Day_Production.xlsx"}
{"timestamp": "2026-02-15T15:40:19.793203Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found xlsx file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\Volume_DateRange_Production.xlsx"}
{"timestamp": "2026-02-15T15:40:19.793556Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found csv file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\Legacy_Hourly_Floor_Tracker.csv"}
{"timestamp": "2026-02-15T15:40:19.793712Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found csv file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\Legacy_Style_Complexity_Log.csv"}
{"timestamp": "2026-02-15T15:40:19.793949Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found csv file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\Unit_Ambiguous_Production.csv"}
{"timestamp": "2026-02-15T15:40:19.794136Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found csv file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\Unit_Messy_Production.csv"}
{"timestamp": "2026-02-15T15:40:19.794282Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Found csv file: C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\tests\\data\\Unit_Perfect_Production.csv"}
{"timestamp": "2026-02-15T15:40:19.794421Z", "level": "INFO", "logger": "app.api.v1.endpoints.samples", "message": "Returning 25 sample files"}
{"timestamp": "2026-02-15T15:40:19.794760Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: GET http://testserver/api/v1/samples/sample-files \"HTTP/1.1 200 OK\""}
------------------------------ Captured log call ------------------------------
INFO     app.api.v1.endpoints.samples:samples.py:38 Sample data directory: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data
INFO     app.api.v1.endpoints.samples:samples.py:39 Directory exists: True
INFO     app.api.v1.endpoints.samples:samples.py:56 All files in directory: [WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/EdgeCase_Abbreviated_Headers.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/EdgeCase_Ambiguous_Headers.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/EdgeCase_Header_Synonyms.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/EdgeCase_Header_Typos.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/EdgeCase_Mixed_Data_Quality.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Feature_Quality_And_Blockers.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Historical_2025-10.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Historical_2025-11.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Historical_2025-12.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Historical_2026-01.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Legacy_Hourly_Floor_Tracker.csv'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Legacy_Style_Complexity_Log.csv'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Sequential_2025-01.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Sequential_2025-02.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Sequential_2025-03.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Standard_Clean_Small.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Standard_Master_Widget.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Unit_Ambiguous_Production.csv'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Unit_Ambiguous_Production.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Unit_Messy_Production.csv'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Unit_Messy_Production.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Unit_Perfect_Production.csv'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Unit_Perfect_Production.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Volume_90Day_Production.xlsx'), WindowsPath('C:/Users/19803/Projects/FactoryExcelManager/backend/tests/data/Volume_DateRange_Production.xlsx')]
INFO     app.api.v1.endpoints.samples:samples.py:59 Found xlsx file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\EdgeCase_Abbreviated_Headers.xlsx
INFO     app.api.v1.endpoints.samples:samples.py:59 Found xlsx file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\EdgeCase_Ambiguous_Headers.xlsx
INFO     app.api.v1.endpoints.samples:samples.py:59 Found xlsx file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\EdgeCase_Header_Synonyms.xlsx
INFO     app.api.v1.endpoints.samples:samples.py:59 Found xlsx file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\EdgeCase_Header_Typos.xlsx
INFO     app.api.v1.endpoints.samples:samples.py:59 Found xlsx file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\EdgeCase_Mixed_Data_Quality.xlsx
INFO     app.api.v1.endpoints.samples:samples.py:59 Found xlsx file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\Feature_Quality_And_Blockers.xlsx
INFO     app.api.v1.endpoints.samples:samples.py:59 Found xlsx file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\Historical_2025-10.xlsx
INFO     app.api.v1.endpoints.samples:samples.py:59 Found xlsx file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\Historical_2025-11.xlsx
INFO     app.api.v1.endpoints.samples:samples.py:59 Found xlsx file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\Historical_2025-12.xlsx
INFO     app.api.v1.endpoints.samples:samples.py:59 Found xlsx file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\Historical_2026-01.xlsx
INFO     app.api.v1.endpoints.samples:samples.py:59 Found xlsx file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\Sequential_2025-01.xlsx
INFO     app.api.v1.endpoints.samples:samples.py:59 Found xlsx file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\Sequential_2025-02.xlsx
INFO     app.api.v1.endpoints.samples:samples.py:59 Found xlsx file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\Sequential_2025-03.xlsx
INFO     app.api.v1.endpoints.samples:samples.py:59 Found xlsx file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\Standard_Clean_Small.xlsx
INFO     app.api.v1.endpoints.samples:samples.py:59 Found xlsx file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\Standard_Master_Widget.xlsx
INFO     app.api.v1.endpoints.samples:samples.py:59 Found xlsx file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\Unit_Ambiguous_Production.xlsx
INFO     app.api.v1.endpoints.samples:samples.py:59 Found xlsx file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\Unit_Messy_Production.xlsx
INFO     app.api.v1.endpoints.samples:samples.py:59 Found xlsx file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\Unit_Perfect_Production.xlsx
INFO     app.api.v1.endpoints.samples:samples.py:59 Found xlsx file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\Volume_90Day_Production.xlsx
INFO     app.api.v1.endpoints.samples:samples.py:59 Found xlsx file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\Volume_DateRange_Production.xlsx
INFO     app.api.v1.endpoints.samples:samples.py:73 Found csv file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\Legacy_Hourly_Floor_Tracker.csv
INFO     app.api.v1.endpoints.samples:samples.py:73 Found csv file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\Legacy_Style_Complexity_Log.csv
INFO     app.api.v1.endpoints.samples:samples.py:73 Found csv file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\Unit_Ambiguous_Production.csv
INFO     app.api.v1.endpoints.samples:samples.py:73 Found csv file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\Unit_Messy_Production.csv
INFO     app.api.v1.endpoints.samples:samples.py:73 Found csv file: C:\Users\19803\Projects\FactoryExcelManager\backend\tests\data\Unit_Perfect_Production.csv
INFO     app.api.v1.endpoints.samples:samples.py:85 Returning 25 sample files
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/api/v1/samples/sample-files "HTTP/1.1 200 OK"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_samples.py:22: AssertionError: assert 'perfect_production.xlsx' in ['EdgeCase_Abbreviated_Headers.xlsx', 'EdgeCase_Ambiguous_Headers.xlsx', 'EdgeCase_Header_Synonyms.xlsx', 'EdgeCase_Header_Typos.xlsx', 'EdgeCase_Mixed_Data_Quality.xlsx', 'Feature_Quality_And_Blockers.xlsx', ...]
E   assert 404 == 200
     +  where 404 = <Response [404 Not Found]>.status_code
---------------------------- Captured stdout setup ----------------------------
{"timestamp": "2026-02-15T15:40:19.825089Z", "level": "INFO", "logger": "app.main", "message": "Starting LineSight v0.1.0"}
{"timestamp": "2026-02-15T15:40:19.825254Z", "level": "INFO", "logger": "app.main", "message": "Database: postgres:5434/linesight"}
{"timestamp": "2026-02-15T15:40:19.825316Z", "level": "INFO", "logger": "app.main", "message": "LLM Provider: deepseek"}
----------------------------- Captured log setup ------------------------------
INFO     app.main:main.py:37 Starting LineSight v0.1.0
INFO     app.main:main.py:38 Database: postgres:5434/linesight
INFO     app.main:main.py:39 LLM Provider: deepseek
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:19.827247Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: GET http://testserver/api/v1/samples/sample-files/perfect_production.xlsx \"HTTP/1.1 404 Not Found\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/api/v1/samples/sample-files/perfect_production.xlsx "HTTP/1.1 404 Not Found"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_samples.py:37: assert 404 == 200
E   assert 404 == 200
     +  where 404 = <Response [404 Not Found]>.status_code
---------------------------- Captured stdout setup ----------------------------
{"timestamp": "2026-02-15T15:40:19.856652Z", "level": "INFO", "logger": "app.main", "message": "Starting LineSight v0.1.0"}
{"timestamp": "2026-02-15T15:40:19.856792Z", "level": "INFO", "logger": "app.main", "message": "Database: postgres:5434/linesight"}
{"timestamp": "2026-02-15T15:40:19.856841Z", "level": "INFO", "logger": "app.main", "message": "LLM Provider: deepseek"}
----------------------------- Captured log setup ------------------------------
INFO     app.main:main.py:37 Starting LineSight v0.1.0
INFO     app.main:main.py:38 Database: postgres:5434/linesight
INFO     app.main:main.py:39 LLM Provider: deepseek
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:19.858362Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: GET http://testserver/api/v1/samples/sample-files/perfect_production.csv \"HTTP/1.1 404 Not Found\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/api/v1/samples/sample-files/perfect_production.csv "HTTP/1.1 404 Not Found"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_samples.py:56: assert 404 == 200
E   NameError: name 'ProductionLine' is not defined
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_schema_config.py:41: NameError: name 'ProductionLine' is not defined
E   NameError: name 'ProductionLine' is not defined
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_schema_mapping_reuse.py:49: NameError: name 'ProductionLine' is not defined
E   NameError: name 'ProductionLine' is not defined
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_schema_mapping_reuse.py:205: NameError: name 'ProductionLine' is not defined
E   AssertionError: Path C:\Users\19803\AppData\Local\Temp\pytest-of-19803\pytest-113\test_storage_segmentation0\uploads\ae456bb6-d68d-454e-98b5-36d06be18a5f\81d7e2d5-e838-4e0a-90ca-860d95838ea9\2026\02 does not exist
    assert False
     +  where False = exists()
     +    where exists = WindowsPath('C:/Users/19803/AppData/Local/Temp/pytest-of-19803/pytest-113/test_storage_segmentation0/uploads/ae456bb6-d68d-454e-98b5-36d06be18a5f/81d7e2d5-e838-4e0a-90ca-860d95838ea9/2026/02').exists
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:21.327189Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/ingestion/upload?factory_id=ae456bb6-d68d-454e-98b5-36d06be18a5f&production_line_id=81d7e2d5-e838-4e0a-90ca-860d95838ea9 \"HTTP/1.1 200 OK\""}
{"timestamp": "2026-02-15T15:40:21.331907Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/ingestion/upload?factory_id=ae456bb6-d68d-454e-98b5-36d06be18a5f&production_line_id=4a8902bf-5f90-43cc-97ea-3f814b2fd8fa \"HTTP/1.1 200 OK\""}
{"timestamp": "2026-02-15T15:40:21.335928Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/ingestion/upload \"HTTP/1.1 422 Unprocessable Entity\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/ingestion/upload?factory_id=ae456bb6-d68d-454e-98b5-36d06be18a5f&production_line_id=81d7e2d5-e838-4e0a-90ca-860d95838ea9 "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/ingestion/upload?factory_id=ae456bb6-d68d-454e-98b5-36d06be18a5f&production_line_id=4a8902bf-5f90-43cc-97ea-3f814b2fd8fa "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/ingestion/upload "HTTP/1.1 422 Unprocessable Entity"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_storage_separation.py:86: AssertionError: Path C:\Users\19803\AppData\Local\Temp\pytest-of-19803\pytest-113\test_storage_segmentation0\uploads\ae456bb6-d68d-454e-98b5-36d06be18a5f\81d7e2d5-e838-4e0a-90ca-860d95838ea9\2026\02 does not exist
E   sqlite3.IntegrityError: NOT NULL constraint failed: factories.code

The above exception was the direct cause of the following exception:
E   sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: factories.code
    [SQL: INSERT INTO factories (organization_id, name, code, country, city, address, timezone, total_lines, total_workers, daily_capacity_units, certifications, locale, is_active, id, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
    [parameters: ('b16ae9b4-8e5d-4b59-8057-4fea047e6e9d', 'Style Factory', None, 'Testland', None, None, 'UTC', None, None, None, None, 'en-US', 1, '56760837-8dca-47ed-9c49-8b8ca9542d29', '2026-02-15 15:40:21.678251', '2026-02-15 15:40:21.678253')]
    (Background on this error at: https://sqlalche.me/e/20/gkpj)
C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\aiosqlite\core.py:63: sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: factories.code
E   NameError: name 'ProductionLine' is not defined
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_upload.py:44: NameError: name 'ProductionLine' is not defined
E   NameError: name 'ProductionLine' is not defined
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_upload.py:65: NameError: name 'ProductionLine' is not defined
E   NameError: name 'ProductionLine' is not defined
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_upload_history.py:37: NameError: name 'ProductionLine' is not defined
E   FileNotFoundError: [Errno 2] No such file or directory: 'tests\\data\\perfect_production.csv'
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_upload_preview.py:20: FileNotFoundError: [Errno 2] No such file or directory: 'tests\\data\\perfect_production.csv'
E   FileNotFoundError: [Errno 2] No such file or directory: 'tests\\data\\perfect_production.csv'
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_upload_preview.py:42: FileNotFoundError: [Errno 2] No such file or directory: 'tests\\data\\perfect_production.csv'
E   FileNotFoundError: [Errno 2] No such file or directory: 'tests\\data\\perfect_production.xlsx'
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_upload_preview.py:82: FileNotFoundError: [Errno 2] No such file or directory: 'tests\\data\\perfect_production.xlsx'
E   assert 422 == 201
     +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-15T15:40:24.954605Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/factories \"HTTP/1.1 422 Unprocessable Entity\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/factories "HTTP/1.1 422 Unprocessable Entity"
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_verification_cascade.py:38: assert 422 == 201
E   NameError: name 'ProductionLine' is not defined
---------------------------- Captured stdout call -----------------------------

============================================================
E2E WIDGET DATA FLOW TEST
============================================================
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_api\test_widget_data_e2e.py:66: NameError: name 'ProductionLine' is not defined
E   sqlite3.OperationalError: no such column: pr.line_id

The above exception was the direct cause of the following exception:
E   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: pr.line_id
    [SQL: 
                SELECT DISTINCT pr.line_id, COUNT(*) as run_count
                FROM production_runs pr
                GROUP BY pr.line_id
            ]
    (Background on this error at: https://sqlalche.me/e/20/e3q8)
---------------------------- Captured stdout call -----------------------------

============================================================
WIDGET ENDPOINT LINE FILTER TEST
============================================================
C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\aiosqlite\core.py:63: sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: pr.line_id
E   socket.gaierror: [Errno 11001] getaddrinfo failed
---------------------------- Captured stdout call -----------------------------

LOG: 1. Attempting login...
{"timestamp": "2026-02-15T15:40:37.412309Z", "level": "ERROR", "logger": "app.main", "message": "Unhandled exception: [Errno 11001] getaddrinfo failed", "exception": "Traceback (most recent call last):\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\middleware\\errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\middleware\\cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\middleware\\exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\middleware\\asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\routing.py\", line 115, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\routing.py\", line 101, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\routing.py\", line 355, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<3 lines>...\n    )\n    ^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\routing.py\", line 243, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\app\\api\\v1\\endpoints\\auth.py\", line 43, in login\n    result = await db.execute(select(User).where(User.email == request.email))\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\ext\\asyncio\\session.py\", line 449, in execute\n    result = await greenlet_spawn(\n             ^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\util\\_concurrency_py3k.py\", line 201, in greenlet_spawn\n    result = context.throw(*sys.exc_info())\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2351, in execute\n    return self._execute_internal(\n           ~~~~~~~~~~~~~~~~~~~~~~^\n        statement,\n        ^^^^^^^^^^\n    ...<4 lines>...\n        _add_event=_add_event,\n        ^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2239, in _execute_internal\n    conn = self._connection_for_bind(bind)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2108, in _connection_for_bind\n    return trans._connection_for_bind(engine, execution_options)\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"<string>\", line 2, in _connection_for_bind\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 137, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1187, in _connection_for_bind\n    conn = bind.connect()\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 3285, in connect\n    return self._connection_cls(self)\n           ~~~~~~~~~~~~~~~~~~~~^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 143, in __init__\n    self._dbapi_connection = engine.raw_connection()\n                             ~~~~~~~~~~~~~~~~~~~~~^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 3309, in raw_connection\n    return self.pool.connect()\n           ~~~~~~~~~~~~~~~~~^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 447, in connect\n    return _ConnectionFairy._checkout(self)\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 1264, in _checkout\n    fairy = _ConnectionRecord.checkout(pool)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 711, in checkout\n    rec = pool._do_get()\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\pool\\impl.py\", line 177, in _do_get\n    with util.safe_reraise():\n         ~~~~~~~~~~~~~~~~~^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 224, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\pool\\impl.py\", line 175, in _do_get\n    return self._create_connection()\n           ~~~~~~~~~~~~~~~~~~~~~~~^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 388, in _create_connection\n    return _ConnectionRecord(self)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 673, in __init__\n    self.__connect()\n    ~~~~~~~~~~~~~~^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 899, in __connect\n    with util.safe_reraise():\n         ~~~~~~~~~~~~~~~~~^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 224, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 895, in __connect\n    self.dbapi_connection = connection = pool._invoke_creator(self)\n                                         ~~~~~~~~~~~~~~~~~~~~^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\engine\\create.py\", line 661, in connect\n    return dialect.connect(*cargs, **cparams)\n           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 630, in connect\n    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501\n           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\dialects\\postgresql\\asyncpg.py\", line 955, in connect\n    await_only(creator_fn(*arg, **kw)),\n    ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\util\\_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\util\\_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\asyncpg\\connection.py\", line 2443, in connect\n    return await connect_utils._connect(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<22 lines>...\n    )\n    ^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\asyncpg\\connect_utils.py\", line 1249, in _connect\n    raise last_error or exceptions.TargetServerAttributeNotMatched(\n    ...<2 lines>...\n    )\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\asyncpg\\connect_utils.py\", line 1218, in _connect\n    conn = await _connect_addr(\n           ^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\asyncpg\\connect_utils.py\", line 1054, in _connect_addr\n    return await __connect_addr(params, True, *args)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\asyncpg\\connect_utils.py\", line 1099, in __connect_addr\n    tr, pr = await connector\n             ^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\asyncpg\\connect_utils.py\", line 969, in _create_ssl_connection\n    tr, pr = await loop.create_connection(\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<2 lines>...\n        host, port)\n        ^^^^^^^^^^^\n  File \"C:\\Python313\\Lib\\asyncio\\base_events.py\", line 1117, in create_connection\n    infos = await self._ensure_resolved(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        (host, port), family=family,\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        type=socket.SOCK_STREAM, proto=proto, flags=flags, loop=self)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Python313\\Lib\\asyncio\\base_events.py\", line 1500, in _ensure_resolved\n    return await loop.getaddrinfo(host, port, family=family, type=type,\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n                                  proto=proto, flags=flags)\n                                  ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Python313\\Lib\\asyncio\\base_events.py\", line 939, in getaddrinfo\n    return await self.run_in_executor(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        None, getaddr_func, host, port, family, type, proto, flags)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Python313\\Lib\\concurrent\\futures\\thread.py\", line 59, in run\n    result = self.fn(*self.args, **self.kwargs)\n  File \"C:\\Python313\\Lib\\socket.py\", line 977, in getaddrinfo\n    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):\n               ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nsocket.gaierror: [Errno 11001] getaddrinfo failed"}
------------------------------ Captured log call ------------------------------
ERROR    app.main:main.py:100 Unhandled exception: [Errno 11001] getaddrinfo failed
Traceback (most recent call last):
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\app\api\v1\endpoints\auth.py", line 43, in login
    result = await db.execute(select(User).where(User.email == request.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2239, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2108, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1187, in _connection_for_bind
    conn = bind.connect()
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3285, in connect
    return self._connection_cls(self)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3309, in raw_connection
    return self.pool.connect()
           ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 711, in checkout
    rec = pool._do_get()
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 177, in _do_get
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 175, in _do_get
    return self._create_connection()
           ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 673, in __init__
    self.__connect()
    ~~~~~~~~~~~~~~^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 899, in __connect
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 661, in connect
    return dialect.connect(*cargs, **cparams)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 630, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 955, in connect
    await_only(creator_fn(*arg, **kw)),
    ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\asyncpg\connection.py", line 2443, in connect
    return await connect_utils._connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<22 lines>...
    )
    ^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1249, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
    ...<2 lines>...
    )
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1218, in _connect
    conn = await _connect_addr(
           ^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1054, in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1099, in __connect_addr
    tr, pr = await connector
             ^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\asyncpg\connect_utils.py", line 969, in _create_ssl_connection
    tr, pr = await loop.create_connection(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        host, port)
        ^^^^^^^^^^^
  File "C:\Python313\Lib\asyncio\base_events.py", line 1117, in create_connection
    infos = await self._ensure_resolved(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        (host, port), family=family,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        type=socket.SOCK_STREAM, proto=proto, flags=flags, loop=self)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python313\Lib\asyncio\base_events.py", line 1500, in _ensure_resolved
    return await loop.getaddrinfo(host, port, family=family, type=type,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                                  proto=proto, flags=flags)
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python313\Lib\asyncio\base_events.py", line 939, in getaddrinfo
    return await self.run_in_executor(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
        None, getaddr_func, host, port, family, type, proto, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python313\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "C:\Python313\Lib\socket.py", line 977, in getaddrinfo
    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):
               ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
socket.gaierror: [Errno 11001] getaddrinfo failed
C:\Python313\Lib\socket.py:977: socket.gaierror: [Errno 11001] getaddrinfo failed
E   socket.gaierror: [Errno 11001] getaddrinfo failed
---------------------------- Captured stdout call -----------------------------
LOG: Attempting login...
{"timestamp": "2026-02-15T15:40:40.145358Z", "level": "ERROR", "logger": "app.main", "message": "Unhandled exception: [Errno 11001] getaddrinfo failed", "exception": "Traceback (most recent call last):\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\middleware\\errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\middleware\\cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\middleware\\exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\middleware\\asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\routing.py\", line 115, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\routing.py\", line 101, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\routing.py\", line 355, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<3 lines>...\n    )\n    ^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\routing.py\", line 243, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\app\\api\\v1\\endpoints\\auth.py\", line 43, in login\n    result = await db.execute(select(User).where(User.email == request.email))\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\ext\\asyncio\\session.py\", line 449, in execute\n    result = await greenlet_spawn(\n             ^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\util\\_concurrency_py3k.py\", line 201, in greenlet_spawn\n    result = context.throw(*sys.exc_info())\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2351, in execute\n    return self._execute_internal(\n           ~~~~~~~~~~~~~~~~~~~~~~^\n        statement,\n        ^^^^^^^^^^\n    ...<4 lines>...\n        _add_event=_add_event,\n        ^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2239, in _execute_internal\n    conn = self._connection_for_bind(bind)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2108, in _connection_for_bind\n    return trans._connection_for_bind(engine, execution_options)\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"<string>\", line 2, in _connection_for_bind\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 137, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1187, in _connection_for_bind\n    conn = bind.connect()\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 3285, in connect\n    return self._connection_cls(self)\n           ~~~~~~~~~~~~~~~~~~~~^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 143, in __init__\n    self._dbapi_connection = engine.raw_connection()\n                             ~~~~~~~~~~~~~~~~~~~~~^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 3309, in raw_connection\n    return self.pool.connect()\n           ~~~~~~~~~~~~~~~~~^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 447, in connect\n    return _ConnectionFairy._checkout(self)\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 1264, in _checkout\n    fairy = _ConnectionRecord.checkout(pool)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 711, in checkout\n    rec = pool._do_get()\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\pool\\impl.py\", line 177, in _do_get\n    with util.safe_reraise():\n         ~~~~~~~~~~~~~~~~~^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 224, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\pool\\impl.py\", line 175, in _do_get\n    return self._create_connection()\n           ~~~~~~~~~~~~~~~~~~~~~~~^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 388, in _create_connection\n    return _ConnectionRecord(self)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 673, in __init__\n    self.__connect()\n    ~~~~~~~~~~~~~~^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 899, in __connect\n    with util.safe_reraise():\n         ~~~~~~~~~~~~~~~~~^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 224, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 895, in __connect\n    self.dbapi_connection = connection = pool._invoke_creator(self)\n                                         ~~~~~~~~~~~~~~~~~~~~^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\engine\\create.py\", line 661, in connect\n    return dialect.connect(*cargs, **cparams)\n           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 630, in connect\n    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501\n           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\dialects\\postgresql\\asyncpg.py\", line 955, in connect\n    await_only(creator_fn(*arg, **kw)),\n    ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\util\\_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\sqlalchemy\\util\\_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\asyncpg\\connection.py\", line 2443, in connect\n    return await connect_utils._connect(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<22 lines>...\n    )\n    ^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\asyncpg\\connect_utils.py\", line 1249, in _connect\n    raise last_error or exceptions.TargetServerAttributeNotMatched(\n    ...<2 lines>...\n    )\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\asyncpg\\connect_utils.py\", line 1218, in _connect\n    conn = await _connect_addr(\n           ^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\asyncpg\\connect_utils.py\", line 1054, in _connect_addr\n    return await __connect_addr(params, True, *args)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\asyncpg\\connect_utils.py\", line 1099, in __connect_addr\n    tr, pr = await connector\n             ^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\asyncpg\\connect_utils.py\", line 969, in _create_ssl_connection\n    tr, pr = await loop.create_connection(\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<2 lines>...\n        host, port)\n        ^^^^^^^^^^^\n  File \"C:\\Python313\\Lib\\asyncio\\base_events.py\", line 1117, in create_connection\n    infos = await self._ensure_resolved(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        (host, port), family=family,\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        type=socket.SOCK_STREAM, proto=proto, flags=flags, loop=self)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Python313\\Lib\\asyncio\\base_events.py\", line 1500, in _ensure_resolved\n    return await loop.getaddrinfo(host, port, family=family, type=type,\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n                                  proto=proto, flags=flags)\n                                  ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Python313\\Lib\\asyncio\\base_events.py\", line 939, in getaddrinfo\n    return await self.run_in_executor(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        None, getaddr_func, host, port, family, type, proto, flags)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Python313\\Lib\\concurrent\\futures\\thread.py\", line 59, in run\n    result = self.fn(*self.args, **self.kwargs)\n  File \"C:\\Python313\\Lib\\socket.py\", line 977, in getaddrinfo\n    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):\n               ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nsocket.gaierror: [Errno 11001] getaddrinfo failed"}
------------------------------ Captured log call ------------------------------
ERROR    app.main:main.py:100 Unhandled exception: [Errno 11001] getaddrinfo failed
Traceback (most recent call last):
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\app\api\v1\endpoints\auth.py", line 43, in login
    result = await db.execute(select(User).where(User.email == request.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2239, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2108, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1187, in _connection_for_bind
    conn = bind.connect()
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3285, in connect
    return self._connection_cls(self)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3309, in raw_connection
    return self.pool.connect()
           ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 711, in checkout
    rec = pool._do_get()
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 177, in _do_get
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 175, in _do_get
    return self._create_connection()
           ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 673, in __init__
    self.__connect()
    ~~~~~~~~~~~~~~^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 899, in __connect
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 661, in connect
    return dialect.connect(*cargs, **cparams)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 630, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 955, in connect
    await_only(creator_fn(*arg, **kw)),
    ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\asyncpg\connection.py", line 2443, in connect
    return await connect_utils._connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<22 lines>...
    )
    ^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1249, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
    ...<2 lines>...
    )
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1218, in _connect
    conn = await _connect_addr(
           ^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1054, in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1099, in __connect_addr
    tr, pr = await connector
             ^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\asyncpg\connect_utils.py", line 969, in _create_ssl_connection
    tr, pr = await loop.create_connection(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        host, port)
        ^^^^^^^^^^^
  File "C:\Python313\Lib\asyncio\base_events.py", line 1117, in create_connection
    infos = await self._ensure_resolved(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        (host, port), family=family,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        type=socket.SOCK_STREAM, proto=proto, flags=flags, loop=self)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python313\Lib\asyncio\base_events.py", line 1500, in _ensure_resolved
    return await loop.getaddrinfo(host, port, family=family, type=type,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                                  proto=proto, flags=flags)
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python313\Lib\asyncio\base_events.py", line 939, in getaddrinfo
    return await self.run_in_executor(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
        None, getaddr_func, host, port, family, type, proto, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python313\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "C:\Python313\Lib\socket.py", line 977, in getaddrinfo
    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):
               ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
socket.gaierror: [Errno 11001] getaddrinfo failed
C:\Python313\Lib\socket.py:977: socket.gaierror: [Errno 11001] getaddrinfo failed
E   sqlite3.IntegrityError: NOT NULL constraint failed: data_sources.factory_id

The above exception was the direct cause of the following exception:
E   sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: data_sources.factory_id
    [SQL: INSERT INTO data_sources (factory_id, name, code, target_operators, target_efficiency_pct, specialty, supervisor_id, production_line_id, source_name, description, time_column, time_format, parent_data_source_id, is_segment, date_range_start, date_range_end, is_active, id, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
    [parameters: (None, None, None, None, None, None, None, '7f7180cf-a8a7-462b-9a08-14ff02d81a1b', 'Test Source', None, None, None, None, 0, None, None, 1, '7891651c-b899-450f-b173-bc790472a568', '2026-02-15 15:40:40.482700', '2026-02-15 15:40:40.482703')]
    (Background on this error at: https://sqlalche.me/e/20/gkpj)
C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\aiosqlite\core.py:63: sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: data_sources.factory_id
E   UnboundLocalError: cannot access local variable 'data_source' where it is not associated with a value
---------------------------- Captured stdout call -----------------------------
--- Created Test Data Source: 515c3b0c-8dff-45dc-8b91-1087ecc9c028 ---
--- Uploading Jan.xlsx ---
{"timestamp": "2026-02-15T15:40:41.352911Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/ingestion/upload?factory_id=c58cfa7c-9776-4fa1-9631-2a722071556f&data_source_id=515c3b0c-8dff-45dc-8b91-1087ecc9c028 \"HTTP/1.1 200 OK\""}
{"timestamp": "2026-02-15T15:40:41.698422Z", "level": "INFO", "logger": "app.services.matching.engine", "message": "MATCH [Hash]: 'Date' -> 'production_date' (Conf: 1.0)"}
{"timestamp": "2026-02-15T15:40:41.698916Z", "level": "INFO", "logger": "app.services.matching.engine", "message": "MATCH [Fuzzy]: 'Units Produced' -> 'actual_qty' (Score: 90)"}
{"timestamp": "2026-02-15T15:40:41.699102Z", "level": "INFO", "logger": "app.services.matching.engine", "message": "MATCH [Hash]: 'Efficiency' -> 'line_efficiency' (Conf: 1.0)"}
{"timestamp": "2026-02-15T15:40:41.699248Z", "level": "INFO", "logger": "app.services.matching.engine", "message": "MATCH [Hash]: 'Style' -> 'style_number' (Conf: 1.0)"}
{"timestamp": "2026-02-15T15:40:41.699334Z", "level": "INFO", "logger": "app.services.matching.engine", "message": "MATCH [Hash]: 'PO' -> 'po_number' (Conf: 1.0)"}
{"timestamp": "2026-02-15T15:40:41.717763Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://test/api/v1/ingestion/process/f0e9bd82-b8ca-4d2a-89f5-92b2b8a2d8a7?factory_id=c58cfa7c-9776-4fa1-9631-2a722071556f \"HTTP/1.1 200 OK\""}
{"timestamp": "2026-02-15T15:40:41.719574Z", "level": "INFO", "logger": "ingestion.confirm_mapping", "message": "============================================================"}
{"timestamp": "2026-02-15T15:40:41.719659Z", "level": "INFO", "logger": "ingestion.confirm_mapping", "message": "CONFIRM-MAPPING ENDPOINT CALLED"}
{"timestamp": "2026-02-15T15:40:41.719702Z", "level": "INFO", "logger": "ingestion.confirm_mapping", "message": "  raw_import_id: f0e9bd82-b8ca-4d2a-89f5-92b2b8a2d8a7"}
{"timestamp": "2026-02-15T15:40:41.719744Z", "level": "INFO", "logger": "ingestion.confirm_mapping", "message": "  production_line_id: None"}
{"timestamp": "2026-02-15T15:40:41.719780Z", "level": "INFO", "logger": "ingestion.confirm_mapping", "message": "  factory_id: c58cfa7c-9776-4fa1-9631-2a722071556f"}
{"timestamp": "2026-02-15T15:40:41.719816Z", "level": "INFO", "logger": "ingestion.confirm_mapping", "message": "  data_source_id: 515c3b0c-8dff-45dc-8b91-1087ecc9c028"}
{"timestamp": "2026-02-15T15:40:41.719850Z", "level": "INFO", "logger": "ingestion.confirm_mapping", "message": "  mappings count: 4"}
{"timestamp": "2026-02-15T15:40:41.719881Z", "level": "INFO", "logger": "ingestion.confirm_mapping", "message": "============================================================"}
{"timestamp": "2026-02-15T15:40:41.721103Z", "level": "ERROR", "logger": "app.main", "message": "Unhandled exception: cannot access local variable 'data_source' where it is not associated with a value", "exception": "Traceback (most recent call last):\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\middleware\\errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\middleware\\cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\middleware\\exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\middleware\\asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\routing.py\", line 115, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\routing.py\", line 101, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\routing.py\", line 355, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<3 lines>...\n    )\n    ^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\venv\\Lib\\site-packages\\fastapi\\routing.py\", line 243, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\19803\\Projects\\FactoryExcelManager\\backend\\app\\api\\v1\\endpoints\\ingestion.py\", line 595, in confirm_mapping\n    if not data_source.schema_config:\n           ^^^^^^^^^^^\nUnboundLocalError: cannot access local variable 'data_source' where it is not associated with a value"}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/ingestion/upload?factory_id=c58cfa7c-9776-4fa1-9631-2a722071556f&data_source_id=515c3b0c-8dff-45dc-8b91-1087ecc9c028 "HTTP/1.1 200 OK"
INFO     app.services.matching.engine:engine.py:167 MATCH [Hash]: 'Date' -> 'production_date' (Conf: 1.0)
INFO     app.services.matching.engine:engine.py:175 MATCH [Fuzzy]: 'Units Produced' -> 'actual_qty' (Score: 90)
INFO     app.services.matching.engine:engine.py:167 MATCH [Hash]: 'Efficiency' -> 'line_efficiency' (Conf: 1.0)
INFO     app.services.matching.engine:engine.py:167 MATCH [Hash]: 'Style' -> 'style_number' (Conf: 1.0)
INFO     app.services.matching.engine:engine.py:167 MATCH [Hash]: 'PO' -> 'po_number' (Conf: 1.0)
INFO     httpx:_client.py:1740 HTTP Request: POST http://test/api/v1/ingestion/process/f0e9bd82-b8ca-4d2a-89f5-92b2b8a2d8a7?factory_id=c58cfa7c-9776-4fa1-9631-2a722071556f "HTTP/1.1 200 OK"
INFO     ingestion.confirm_mapping:ingestion.py:517 ============================================================
INFO     ingestion.confirm_mapping:ingestion.py:518 CONFIRM-MAPPING ENDPOINT CALLED
INFO     ingestion.confirm_mapping:ingestion.py:519   raw_import_id: f0e9bd82-b8ca-4d2a-89f5-92b2b8a2d8a7
INFO     ingestion.confirm_mapping:ingestion.py:520   production_line_id: None
INFO     ingestion.confirm_mapping:ingestion.py:521   factory_id: c58cfa7c-9776-4fa1-9631-2a722071556f
INFO     ingestion.confirm_mapping:ingestion.py:522   data_source_id: 515c3b0c-8dff-45dc-8b91-1087ecc9c028
INFO     ingestion.confirm_mapping:ingestion.py:523   mappings count: 4
INFO     ingestion.confirm_mapping:ingestion.py:524 ============================================================
ERROR    app.main:main.py:100 Unhandled exception: cannot access local variable 'data_source' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\fastapi\routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\19803\Projects\FactoryExcelManager\backend\app\api\v1\endpoints\ingestion.py", line 595, in confirm_mapping
    if not data_source.schema_config:
           ^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'data_source' where it is not associated with a value
C:\Users\19803\Projects\FactoryExcelManager\backend\app\api\v1\endpoints\ingestion.py:595: UnboundLocalError: cannot access local variable 'data_source' where it is not associated with a value
E   sqlite3.IntegrityError: NOT NULL constraint failed: data_sources.factory_id

The above exception was the direct cause of the following exception:
E   sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: data_sources.factory_id
    [SQL: INSERT INTO data_sources (factory_id, name, code, target_operators, target_efficiency_pct, specialty, supervisor_id, production_line_id, source_name, description, time_column, time_format, parent_data_source_id, is_segment, date_range_start, date_range_end, is_active, id, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
    [parameters: (None, None, None, None, None, None, None, '29806bc8-81a6-4422-aabd-4fcde5491428', 'Test', 'Desc', None, None, None, 0, None, None, 1, '29a49321-51b7-46cc-9b61-61b849463e7f', '2026-02-15 15:40:41.981948', '2026-02-15 15:40:41.981951')]
    (Background on this error at: https://sqlalche.me/e/20/gkpj)
C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\aiosqlite\core.py:63: sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: data_sources.factory_id
E   sqlite3.IntegrityError: NOT NULL constraint failed: data_sources.factory_id

The above exception was the direct cause of the following exception:
E   sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: data_sources.factory_id
    [SQL: INSERT INTO data_sources (factory_id, name, code, target_operators, target_efficiency_pct, specialty, supervisor_id, production_line_id, source_name, description, time_column, time_format, parent_data_source_id, is_segment, date_range_start, date_range_end, is_active, id, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
    [parameters: (None, None, None, None, None, None, None, '4f531ec4-dd28-4348-853e-ebb55ccdadd2', 'Test2', 'Desc2', None, None, None, 0, None, None, 1, 'b83adff8-1cc9-4677-902c-ad0530610876', '2026-02-15 15:40:42.112021', '2026-02-15 15:40:42.112024')]
    (Background on this error at: https://sqlalche.me/e/20/gkpj)
C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\aiosqlite\core.py:63: sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: data_sources.factory_id
E   sqlite3.IntegrityError: NOT NULL constraint failed: data_sources.factory_id

The above exception was the direct cause of the following exception:
E   sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: data_sources.factory_id
    [SQL: INSERT INTO data_sources (factory_id, name, code, target_operators, target_efficiency_pct, specialty, supervisor_id, production_line_id, source_name, description, time_column, time_format, parent_data_source_id, is_segment, date_range_start, date_range_end, is_active, id, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
    [parameters: (None, None, None, None, None, None, None, 'f3f00b35-287e-4a11-937c-8d8ae0913f03', 'Test Source', 'Test data source', None, None, None, 0, None, None, 1, '5853fead-aa5a-4552-b9ba-46ae327d4edb', '2026-02-15 15:40:42.239486', '2026-02-15 15:40:42.239488')]
    (Background on this error at: https://sqlalche.me/e/20/gkpj)
C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\aiosqlite\core.py:63: sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: data_sources.factory_id
E   sqlite3.IntegrityError: NOT NULL constraint failed: data_sources.factory_id

The above exception was the direct cause of the following exception:
E   sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: data_sources.factory_id
    [SQL: INSERT INTO data_sources (factory_id, name, code, target_operators, target_efficiency_pct, specialty, supervisor_id, production_line_id, source_name, description, time_column, time_format, parent_data_source_id, is_segment, date_range_start, date_range_end, is_active, id, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
    [parameters: (None, None, None, None, None, None, None, 'ef9155bd-c899-4969-9339-801589859c9e', 'Test3', 'Desc3', None, None, None, 0, None, None, 1, '8292e18e-508e-4861-b9bf-e369c34e6183', '2026-02-15 15:40:42.359222', '2026-02-15 15:40:42.359226')]
    (Background on this error at: https://sqlalche.me/e/20/gkpj)
C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\aiosqlite\core.py:63: sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: data_sources.factory_id
E   sqlite3.IntegrityError: NOT NULL constraint failed: data_sources.factory_id

The above exception was the direct cause of the following exception:
E   sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: data_sources.factory_id
    [SQL: INSERT INTO data_sources (factory_id, name, code, target_operators, target_efficiency_pct, specialty, supervisor_id, production_line_id, source_name, description, time_column, time_format, parent_data_source_id, is_segment, date_range_start, date_range_end, is_active, id, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
    [parameters: (None, None, None, None, None, None, None, 'be60441d-1f82-48fa-88d5-290e61287570', 'Test4', 'Desc4', None, None, None, 0, None, None, 1, '4c04afa6-413a-4ff1-8ba9-6162eac930e1', '2026-02-15 15:40:42.487117', '2026-02-15 15:40:42.487120')]
    (Background on this error at: https://sqlalche.me/e/20/gkpj)
C:\Users\19803\Projects\FactoryExcelManager\backend\venv\Lib\site-packages\aiosqlite\core.py:63: sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: data_sources.factory_id
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for ProductionRunCreate
    production_date
      Input should be a valid date [type=date_type, input_value=None, input_type=NoneType]
        For further information visit https://errors.pydantic.dev/2.12/v/date_type
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_services\test_production_schema.py:40: pydantic_core._pydantic_core.ValidationError: 1 validation error for ProductionRunCreate
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for ProductionRunCreate
    production_date
      Input should be a valid date [type=date_type, input_value=None, input_type=NoneType]
        For further information visit https://errors.pydantic.dev/2.12/v/date_type
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_services\test_production_schema.py:57: pydantic_core._pydantic_core.ValidationError: 1 validation error for ProductionRunCreate
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for ProductionRunCreate
    production_date
      Input should be a valid date [type=date_type, input_value=None, input_type=NoneType]
        For further information visit https://errors.pydantic.dev/2.12/v/date_type
C:\Users\19803\Projects\FactoryExcelManager\backend\tests\test_services\test_production_schema.py:180: pydantic_core._pydantic_core.ValidationError: 1 validation error for ProductionRunCreate
=========================== short test summary info ===========================
FAILED backend\tests\api\test_analytics_flaws.py::test_hourly_production_no_events_returns_zeros
FAILED backend\tests\api\test_analytics_flaws.py::test_midnight_boundary_respects_timezone
FAILED backend\tests\api\v1\test_factory_settings.py::test_factory_settings_localization_and_snapshot
FAILED backend\tests\api\v1\test_users.py::test_update_user_invalid_preference_type
FAILED backend\tests\test_api\test_ai_decisions.py::test_get_data_source_ai_decisions
FAILED backend\tests\test_api\test_auth.py::test_login_success - AttributeErr...
FAILED backend\tests\test_api\test_auth.py::test_login_invalid_password - Att...
FAILED backend\tests\test_api\test_dashboard_creation_flow.py::test_complete_dashboard_creation_flow
FAILED backend\tests\test_api\test_dashboard_creation_flow.py::test_dashboard_creation_blocked_by_factory_quota
FAILED backend\tests\test_api\test_dashboard_creation_flow.py::test_multiple_dashboards_same_data_source
FAILED backend\tests\test_api\test_dashboard_creation_flow.py::test_list_dashboards_filtered_by_factory
FAILED backend\tests\test_api\test_dashboard_widgets.py::test_get_dhu_quality_trend
FAILED backend\tests\test_api\test_dashboard_widgets.py::test_get_style_progress
FAILED backend\tests\test_api\test_datasource.py::test_create_data_source - A...
FAILED backend\tests\test_api\test_destructive_flows.py::test_delete_datasource_cascade
FAILED backend\tests\test_api\test_destructive_flows.py::test_clear_history_file_cleanup
FAILED backend\tests\test_api\test_destructive_flows.py::test_clear_history_missing_file
FAILED backend\tests\test_api\test_destructive_flows.py::test_permissions_restricted_delete
FAILED backend\tests\test_api\test_destructive_flows.py::test_deep_data_cleanup
FAILED backend\tests\test_api\test_destructive_flows.py::test_cross_tenant_isolation
FAILED backend\tests\test_api\test_destructive_flows.py::test_audit_logging_mock
FAILED backend\tests\test_api\test_error_handling.py::test_delete_204_response
FAILED backend\tests\test_api\test_excel_to_widget_integrity.py::test_golden_master_excel_to_overview_widget
FAILED backend\tests\test_api\test_excel_to_widget_integrity.py::test_golden_master_physics_validation_triggers
FAILED backend\tests\test_api\test_factories.py::test_create_factory - assert...
FAILED backend\tests\test_api\test_factories.py::test_list_factories - assert...
FAILED backend\tests\test_api\test_factories.py::test_production_line_crud - ...
FAILED backend\tests\test_api\test_fallback_logic.py::test_overview_fallback
FAILED backend\tests\test_api\test_fallback_logic.py::test_sam_performance_fallback
FAILED backend\tests\test_api\test_fallback_logic.py::test_hourly_fallback - ...
FAILED backend\tests\test_api\test_individual_widgets.py::test_get_hourly_production
FAILED backend\tests\test_api\test_individual_widgets.py::test_get_sam_performance
FAILED backend\tests\test_api\test_individual_widgets.py::test_get_workforce_stats
FAILED backend\tests\test_api\test_individual_widgets.py::test_get_dhu_history
FAILED backend\tests\test_api\test_individual_widgets.py::test_get_speed_vs_quality
FAILED backend\tests\test_api\test_ingestion_deduplication.py::test_ingestion_deduplication
FAILED backend\tests\test_api\test_ingestion_deduplication.py::test_mapping_state_endpoint
FAILED backend\tests\test_api\test_ingestion_deduplication.py::test_process_idempotency
FAILED backend\tests\test_api\test_ingestion_flow.py::test_full_ingestion_flow
FAILED backend\tests\test_api\test_ingestion_flow.py::test_schema_evolution
FAILED backend\tests\test_api\test_integrity.py::test_canonical_mapping_validation
FAILED backend\tests\test_api\test_line_management.py::test_reset_schema_configuration
FAILED backend\tests\test_api\test_line_management.py::test_clear_upload_history
FAILED backend\tests\test_api\test_preview.py::test_preview_endpoint_success
FAILED backend\tests\test_api\test_preview.py::test_list_uploads_includes_datasource_id
FAILED backend\tests\test_api\test_production.py::test_production_run_lifecycle
FAILED backend\tests\test_api\test_promotion.py::test_promotion_logic_full_cycle
FAILED backend\tests\test_api\test_quota_enforcement.py::test_factory_quota_enforced
FAILED backend\tests\test_api\test_quota_enforcement.py::test_soft_deleted_factories_not_counted
FAILED backend\tests\test_api\test_quota_enforcement.py::test_enterprise_tier_quotas
FAILED backend\tests\test_api\test_quota_enforcement.py::test_quota_at_exact_limit
FAILED backend\tests\test_api\test_quota_enforcement.py::test_zero_quota_blocks_creation
FAILED backend\tests\test_api\test_repro_500.py::test_list_dashboards_by_factory_id_crash
FAILED backend\tests\test_api\test_samples.py::test_list_sample_files - Asser...
FAILED backend\tests\test_api\test_samples.py::test_download_sample_file - as...
FAILED backend\tests\test_api\test_samples.py::test_download_csv_sample_file
FAILED backend\tests\test_api\test_schema_config.py::test_schema_configuration_flow
FAILED backend\tests\test_api\test_schema_mapping_reuse.py::test_confirm_mapping_deactivates_previous
FAILED backend\tests\test_api\test_schema_mapping_reuse.py::test_schema_mapping_version_increments_correctly
FAILED backend\tests\test_api\test_storage_separation.py::test_storage_segmentation
FAILED backend\tests\test_api\test_style_progress.py::test_get_style_progress_with_pending_orders
FAILED backend\tests\test_api\test_upload.py::TestUploadEndpoints::test_upload_rejects_non_excel
FAILED backend\tests\test_api\test_upload.py::TestUploadEndpoints::test_upload_accepts_xlsx
FAILED backend\tests\test_api\test_upload_history.py::test_upload_history_segmentation
FAILED backend\tests\test_api\test_upload_preview.py::test_upload_csv_file - ...
FAILED backend\tests\test_api\test_upload_preview.py::test_preview_csv_file
FAILED backend\tests\test_api\test_upload_preview.py::test_preview_excel_file
FAILED backend\tests\test_api\test_verification_cascade.py::test_factory_deletion_cascade_behavior
FAILED backend\tests\test_api\test_widget_data_e2e.py::test_full_widget_data_flow
FAILED backend\tests\test_api\test_widget_data_e2e.py::test_widget_endpoint_with_line_filter
FAILED backend\tests\test_async_flow.py::test_datasource_lifecycle - socket.g...
FAILED backend\tests\test_datasource_flow.py::test_datasource_flow - socket.g...
FAILED backend\tests\test_ingestion\test_full_flow.py::test_full_data_flow - ...
FAILED backend\tests\test_sequential_ingestion.py::test_jan_feb_march_continuity
FAILED backend\tests\test_services\test_ai_decision_logging.py::test_schema_inference_logging
FAILED backend\tests\test_services\test_ai_decision_logging.py::test_code_generation_logging
FAILED backend\tests\test_services\test_ai_decision_logging.py::test_ai_decision_data_source_relationship
FAILED backend\tests\test_services\test_ai_decision_logging.py::test_ai_decision_confidence_calculation
FAILED backend\tests\test_services\test_ai_decision_logging.py::test_ai_decision_metadata_completeness
FAILED backend\tests\test_services\test_production_schema.py::TestProductionDateValidator::test_parse_mm_dd_format
FAILED backend\tests\test_services\test_production_schema.py::TestProductionDateValidator::test_parse_mm_slash_dd_format
FAILED backend\tests\test_services\test_production_schema.py::TestProductionDateValidator::test_edge_case_dates
ERROR backend\tests\api\v1\test_team.py::test_list_members_as_owner - Attribu...
ERROR backend\tests\api\v1\test_team.py::test_list_members_as_manager_forbidden
ERROR backend\tests\api\v1\test_team.py::test_assign_user_to_line - Attribute...
ERROR backend\tests\api\v1\test_team.py::test_remove_user_scope - AttributeEr...
ERROR backend\tests\api\v1\test_team.py::test_cannot_assign_cross_org_user - ...
ERROR backend\tests\e2e\test_excel_to_dashboard.py::test_e2e_excel_ingestion_and_dashboard
ERROR backend\tests\test_api\test_dashboard_flow.py::test_edit_configuration
ERROR backend\tests\test_api\test_dashboard_flow.py::test_view_uploaded_files
ERROR backend\tests\test_api\test_dashboard_flow.py::test_upload_history_isolation
ERROR backend\tests\test_api\test_dashboard_flow.py::test_upload_history_simple_endpoint
ERROR backend\tests\test_api\test_data_pipeline_robust.py::test_value_preservation_through_pipeline
ERROR backend\tests\test_api\test_data_pipeline_robust.py::test_date_format_handling
ERROR backend\tests\test_api\test_data_pipeline_robust.py::test_efficiency_normalization
ERROR backend\tests\test_api\test_data_pipeline_robust.py::test_null_handling
ERROR backend\tests\test_api\test_data_pipeline_robust.py::test_data_integrity_across_multiple_rows
ERROR backend\tests\test_api\test_data_pipeline_robust.py::test_style_and_order_creation
ERROR backend\tests\test_api\test_data_pipeline_robust.py::test_duplicate_upload_handling
ERROR backend\tests\test_api\test_data_pipeline_robust.py::test_multiple_widgets_receive_correct_data
ERROR backend\tests\test_api\test_data_pipeline_robust.py::test_invalid_data_handling
ERROR backend\tests\test_api\test_data_pipeline_robust.py::test_analytics_sum_matches_database
ERROR backend\tests\test_api\test_datasource.py::test_get_data_source - Asser...
ERROR backend\tests\test_api\test_datasource.py::test_get_data_source_by_line
ERROR backend\tests\test_api\test_datasource.py::test_update_schema_mapping
ERROR backend\tests\test_api\test_datasource.py::test_create_duplicate_data_source_fails
ERROR backend\tests\test_api\test_datasources_by_line.py::test_get_datasource_by_line_exists
ERROR backend\tests\test_api\test_datasources_by_line.py::test_get_datasource_by_line_none
ERROR backend\tests\test_api\test_datasources_by_line.py::test_get_datasource_cross_line_isolation
ERROR backend\tests\test_api\test_datasources_by_line.py::test_update_datasource
ERROR backend\tests\test_api\test_demo_pipeline.py::test_demo_full_pipeline_with_excel_file
ERROR backend\tests\test_api\test_demo_pipeline.py::test_demo_data_values_integrity
ERROR backend\tests\test_api\test_dry_run_flow.py::test_dry_run_preview_structure
ERROR backend\tests\test_api\test_dry_run_flow.py::test_date_auto_fixing_detection
ERROR backend\tests\test_api\test_dry_run_flow.py::test_efficiency_percentage_cleaning
ERROR backend\tests\test_api\test_dry_run_flow.py::test_decimal_field_handling
ERROR backend\tests\test_api\test_dry_run_flow.py::test_integer_field_cleaning
ERROR backend\tests\test_api\test_dry_run_flow.py::test_column_mapping_application
ERROR backend\tests\test_api\test_dry_run_flow.py::test_overall_status_with_warnings
ERROR backend\tests\test_api\test_dry_run_flow.py::test_overall_status_all_valid
ERROR backend\tests\test_api\test_dry_run_flow.py::test_promotion_after_dry_run_approval
ERROR backend\tests\test_api\test_dry_run_flow.py::test_dry_run_with_missing_schema_mapping
ERROR backend\tests\test_api\test_dry_run_flow.py::test_dry_run_limits_to_20_rows
ERROR backend\tests\test_api\test_dry_run_flow.py::test_raw_data_preserved_in_preview
ERROR backend\tests\test_api\test_preview_dry_run_endpoint.py::test_preview_dry_run_endpoint
ERROR backend\tests\test_api\test_quality_import.py::test_quality_data_promotion
ERROR backend\tests\test_api\test_quota_enforcement.py::test_line_quota_enforced
ERROR backend\tests\test_api\test_quota_enforcement.py::test_quota_status_endpoint
ERROR backend\tests\test_widget_judge.py::test_judge_workforce_integrity_and_scope
ERROR backend\tests\test_widget_judge.py::test_judge_overview_timezone_and_scope
ERROR backend\tests\test_widget_judge.py::test_judge_no_fake_simulation - Nam...
======= 82 failed, 107 passed, 1 skipped, 49 errors in 64.82s (0:01:04) =======
