"""initial_schema_with_rbac

Revision ID: 7684e329d9fc
Revises: 
Create Date: 2026-01-07 07:54:19.986617+00:00

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import mysql

# revision identifiers, used by Alembic.
revision: str = '7684e329d9fc'
down_revision: Union[str, None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('dashboards',
    sa.Column('user_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('name', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('data_source_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('widget_config', sa.Text(), nullable=True),
    sa.Column('layout_config', sa.Text(), nullable=True),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.id'], name='fk_dashboard_datasource', ondelete='SET NULL', use_alter=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name='fk_dashboard_user', ondelete='CASCADE', use_alter=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_dashboards_data_source_id'), 'dashboards', ['data_source_id'], unique=False)
    op.create_index(op.f('ix_dashboards_user_id'), 'dashboards', ['user_id'], unique=False)
    op.create_table('factories',
    sa.Column('organization_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('code', sa.String(length=50), nullable=True),
    sa.Column('country', sa.String(length=100), nullable=False),
    sa.Column('city', sa.String(length=100), nullable=True),
    sa.Column('address', sa.Text(), nullable=True),
    sa.Column('timezone', sa.String(length=50), nullable=False),
    sa.Column('total_lines', sa.Integer(), nullable=True),
    sa.Column('total_workers', sa.Integer(), nullable=True),
    sa.Column('daily_capacity_units', sa.Integer(), nullable=True),
    sa.Column('certifications', sa.Text(), nullable=True),
    sa.Column('settings', sa.JSON(), nullable=True),
    sa.Column('locale', sa.String(length=20), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], name='fk_factory_org', ondelete='CASCADE', use_alter=True),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('code')
    )
    op.create_index(op.f('ix_factories_organization_id'), 'factories', ['organization_id'], unique=False)
    op.create_table('organizations',
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('code', sa.String(length=50), nullable=True),
    sa.Column('subscription_tier', sa.Enum('STARTER', 'PRO', 'ENTERPRISE', name='subscriptiontier'), nullable=False),
    sa.Column('settings', sa.Text(), nullable=True),
    sa.Column('max_factories', sa.Integer(), nullable=False),
    sa.Column('max_lines_per_factory', sa.Integer(), nullable=False),
    sa.Column('primary_email', sa.String(length=255), nullable=True),
    sa.Column('primary_phone', sa.String(length=50), nullable=True),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('is_deleted', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('code')
    )
    op.create_table('production_lines',
    sa.Column('factory_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('code', sa.String(length=50), nullable=True),
    sa.Column('target_operators', sa.Integer(), nullable=True),
    sa.Column('target_efficiency_pct', sa.Integer(), nullable=True),
    sa.Column('settings', sa.JSON(), nullable=True),
    sa.Column('specialty', sa.String(length=100), nullable=True),
    sa.Column('supervisor_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['factory_id'], ['factories.id'], name='fk_line_factory', ondelete='CASCADE', use_alter=True),
    sa.ForeignKeyConstraint(['supervisor_id'], ['workers.id'], name='fk_line_supervisor', ondelete='SET NULL', use_alter=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_production_lines_factory_id'), 'production_lines', ['factory_id'], unique=False)
    op.create_table('workers',
    sa.Column('factory_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('employee_id', sa.String(length=50), nullable=False),
    sa.Column('full_name', sa.String(length=255), nullable=False),
    sa.Column('department', sa.String(length=100), nullable=True),
    sa.Column('job_title', sa.String(length=100), nullable=True),
    sa.Column('primary_skill', sa.String(length=100), nullable=True),
    sa.Column('line_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('hire_date', sa.Date(), nullable=True),
    sa.Column('termination_date', sa.Date(), nullable=True),
    sa.Column('hourly_rate', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('currency', sa.String(length=3), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('is_deleted', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['factory_id'], ['factories.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['line_id'], ['production_lines.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('factory_id', 'employee_id', name='uq_factory_employee')
    )
    op.create_index(op.f('ix_workers_employee_id'), 'workers', ['employee_id'], unique=False)
    op.create_index(op.f('ix_workers_factory_id'), 'workers', ['factory_id'], unique=False)
    op.create_table('data_sources',
    sa.Column('production_line_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('source_name', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('time_column', sa.String(length=100), nullable=True),
    sa.Column('time_format', sa.String(length=50), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['production_line_id'], ['production_lines.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_data_sources_production_line_id'), 'data_sources', ['production_line_id'], unique=True)
    op.create_table('dhu_reports',
    sa.Column('factory_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('report_date', sa.Date(), nullable=False),
    sa.Column('period_type', sa.Enum('DAILY', 'WEEKLY', 'MONTHLY', name='periodtype'), nullable=False),
    sa.Column('avg_dhu', sa.Numeric(precision=6, scale=2), nullable=True),
    sa.Column('min_dhu', sa.Numeric(precision=6, scale=2), nullable=True),
    sa.Column('max_dhu', sa.Numeric(precision=6, scale=2), nullable=True),
    sa.Column('total_inspected', sa.Integer(), nullable=True),
    sa.Column('total_defects', sa.Integer(), nullable=True),
    sa.Column('total_rejected', sa.Integer(), nullable=True),
    sa.Column('top_defects', sa.Text(), nullable=True),
    sa.Column('top_operations', sa.Text(), nullable=True),
    sa.Column('top_lines', sa.Text(), nullable=True),
    sa.Column('dhu_change_pct', sa.Numeric(precision=6, scale=2), nullable=True),
    sa.Column('trend_direction', sa.String(length=20), nullable=True),
    sa.Column('recommendations', sa.Text(), nullable=True),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['factory_id'], ['factories.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('factory_id', 'report_date', 'period_type', name='uq_factory_date_period')
    )
    op.create_index(op.f('ix_dhu_reports_factory_id'), 'dhu_reports', ['factory_id'], unique=False)
    op.create_index(op.f('ix_dhu_reports_report_date'), 'dhu_reports', ['report_date'], unique=False)
    op.create_table('styles',
    sa.Column('factory_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('style_number', sa.String(length=100), nullable=False),
    sa.Column('style_name', sa.String(length=255), nullable=True),
    sa.Column('description', sa.String(length=500), nullable=True),
    sa.Column('buyer', sa.String(length=255), nullable=True),
    sa.Column('season', sa.String(length=50), nullable=True),
    sa.Column('category', sa.String(length=100), nullable=True),
    sa.Column('base_sam', sa.Numeric(precision=12, scale=4), nullable=True),
    sa.Column('complexity_rating', sa.String(length=20), nullable=True),
    sa.Column('bom_summary', sa.JSON(), nullable=True),
    sa.Column('tech_pack_url', sa.String(length=500), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['factory_id'], ['factories.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('factory_id', 'style_number', name='uq_factory_style')
    )
    op.create_index(op.f('ix_styles_buyer'), 'styles', ['buyer'], unique=False)
    op.create_index(op.f('ix_styles_factory_id'), 'styles', ['factory_id'], unique=False)
    op.create_index(op.f('ix_styles_style_number'), 'styles', ['style_number'], unique=False)
    op.create_table('users',
    sa.Column('organization_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('email', sa.String(length=255), nullable=False),
    sa.Column('hashed_password', sa.String(length=255), nullable=False),
    sa.Column('full_name', sa.String(length=255), nullable=True),
    sa.Column('avatar_url', sa.String(length=500), nullable=True),
    sa.Column('timezone', sa.String(length=50), nullable=True),
    sa.Column('preferences', sa.Text(), nullable=True),
    sa.Column('role', sa.Enum('SYSTEM_ADMIN', 'OWNER', 'MANAGER', 'ANALYST', 'VIEWER', name='userrole'), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('is_verified', sa.Boolean(), nullable=False),
    sa.Column('last_login', sa.DateTime(timezone=True), nullable=True),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('is_deleted', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('email')
    )
    op.create_index(op.f('ix_users_organization_id'), 'users', ['organization_id'], unique=False)
    op.create_table('worker_attendances',
    sa.Column('worker_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('work_date', sa.Date(), nullable=False),
    sa.Column('clock_in', sa.Time(), nullable=True),
    sa.Column('clock_out', sa.Time(), nullable=True),
    sa.Column('hours_regular', sa.Numeric(precision=4, scale=2), nullable=True),
    sa.Column('hours_overtime', sa.Numeric(precision=4, scale=2), nullable=True),
    sa.Column('hours_total', sa.Numeric(precision=4, scale=2), nullable=True),
    sa.Column('is_present', sa.Boolean(), nullable=False),
    sa.Column('absence_reason', sa.String(length=100), nullable=True),
    sa.Column('is_approved', sa.Boolean(), nullable=False),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['worker_id'], ['workers.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('worker_id', 'work_date', name='uq_worker_date')
    )
    op.create_index(op.f('ix_worker_attendances_work_date'), 'worker_attendances', ['work_date'], unique=False)
    op.create_index(op.f('ix_worker_attendances_worker_id'), 'worker_attendances', ['worker_id'], unique=False)
    op.create_table('worker_skills',
    sa.Column('worker_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('operation', sa.String(length=100), nullable=False),
    sa.Column('operation_category', sa.String(length=100), nullable=True),
    sa.Column('proficiency_pct', sa.Numeric(precision=5, scale=2), nullable=True),
    sa.Column('sam_achieved', sa.Numeric(precision=8, scale=2), nullable=True),
    sa.Column('efficiency_pct', sa.Numeric(precision=5, scale=2), nullable=True),
    sa.Column('defect_rate_pct', sa.Numeric(precision=5, scale=2), nullable=True),
    sa.Column('pieces_lifetime', sa.Integer(), nullable=True),
    sa.Column('pieces_30d', sa.Integer(), nullable=True),
    sa.Column('is_certified', sa.Boolean(), nullable=False),
    sa.Column('certification_date', sa.Date(), nullable=True),
    sa.Column('last_assessed', sa.DateTime(timezone=True), nullable=True),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['worker_id'], ['workers.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('worker_id', 'operation', name='uq_worker_operation')
    )
    op.create_index(op.f('ix_worker_skills_operation'), 'worker_skills', ['operation'], unique=False)
    op.create_index(op.f('ix_worker_skills_worker_id'), 'worker_skills', ['worker_id'], unique=False)
    op.create_table('ai_decisions',
    sa.Column('data_source_id', sa.String(length=36), nullable=True),
    sa.Column('agent_type', sa.Enum('SCHEMA_INFERENCE', 'CODE_GENERATION', name='agenttype'), nullable=False),
    sa.Column('model_used', sa.String(length=50), nullable=False),
    sa.Column('input_summary', sa.Text(), nullable=False),
    sa.Column('output_summary', sa.Text(), nullable=False),
    sa.Column('confidence', sa.Float(), nullable=True),
    sa.Column('reasoning', sa.JSON(), nullable=True),
    sa.Column('performance_metadata', sa.JSON(), nullable=True),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_ai_decisions_agent_type'), 'ai_decisions', ['agent_type'], unique=False)
    op.create_index(op.f('ix_ai_decisions_data_source_id'), 'ai_decisions', ['data_source_id'], unique=False)
    op.create_table('alias_mappings',
    sa.Column('scope', sa.String(length=50), nullable=False),
    sa.Column('organization_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('factory_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('source_alias', sa.String(length=255), nullable=False),
    sa.Column('source_alias_normalized', sa.String(length=255), nullable=False),
    sa.Column('canonical_field', sa.String(length=100), nullable=False),
    sa.Column('usage_count', sa.Integer(), nullable=False),
    sa.Column('last_used_at', sa.DateTime(), nullable=False),
    sa.Column('created_by_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('correction_count', sa.Integer(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['factory_id'], ['factories.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('scope', 'organization_id', 'factory_id', 'source_alias_normalized', name='uq_alias_per_scope')
    )
    op.create_index(op.f('ix_alias_mappings_canonical_field'), 'alias_mappings', ['canonical_field'], unique=False)
    op.create_index(op.f('ix_alias_mappings_factory_id'), 'alias_mappings', ['factory_id'], unique=False)
    op.create_index(op.f('ix_alias_mappings_organization_id'), 'alias_mappings', ['organization_id'], unique=False)
    op.create_index(op.f('ix_alias_mappings_scope'), 'alias_mappings', ['scope'], unique=False)
    op.create_index(op.f('ix_alias_mappings_source_alias'), 'alias_mappings', ['source_alias'], unique=False)
    op.create_index(op.f('ix_alias_mappings_source_alias_normalized'), 'alias_mappings', ['source_alias_normalized'], unique=False)
    op.create_table('orders',
    sa.Column('style_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('po_number', sa.String(length=100), nullable=False),
    sa.Column('quantity', sa.Integer(), nullable=False),
    sa.Column('size_breakdown', sa.JSON(), nullable=True),
    sa.Column('uom', sa.String(length=20), nullable=False),
    sa.Column('color', sa.String(length=100), nullable=True),
    sa.Column('order_date', sa.DateTime(), nullable=True),
    sa.Column('planned_cut_date', sa.DateTime(), nullable=True),
    sa.Column('planned_sew_date', sa.DateTime(), nullable=True),
    sa.Column('ex_factory_date', sa.DateTime(), nullable=True),
    sa.Column('actual_ship_date', sa.DateTime(), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=False),
    sa.Column('priority', sa.String(length=20), nullable=False),
    sa.Column('qty_cut', sa.Integer(), nullable=False),
    sa.Column('qty_sewn', sa.Integer(), nullable=False),
    sa.Column('qty_packed', sa.Integer(), nullable=False),
    sa.Column('qty_shipped', sa.Integer(), nullable=False),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['style_id'], ['styles.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('style_id', 'po_number', name='uq_style_po')
    )
    op.create_index(op.f('ix_orders_po_number'), 'orders', ['po_number'], unique=False)
    op.create_index(op.f('ix_orders_status'), 'orders', ['status'], unique=False)
    op.create_index(op.f('ix_orders_style_id'), 'orders', ['style_id'], unique=False)
    op.create_table('raw_imports',
    sa.Column('uploaded_by_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('factory_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('production_line_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('data_source_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('time_column_used', sa.String(length=100), nullable=True),
    sa.Column('original_filename', sa.String(length=500), nullable=False),
    sa.Column('file_path', sa.String(length=1000), nullable=False),
    sa.Column('file_size_bytes', sa.Integer(), nullable=False),
    sa.Column('file_hash', sa.String(length=64), nullable=False),
    sa.Column('mime_type', sa.String(length=100), nullable=True),
    sa.Column('encoding_detected', sa.String(length=50), nullable=True),
    sa.Column('sheet_count', sa.Integer(), nullable=False),
    sa.Column('sheet_names', sa.Text(), nullable=True),
    sa.Column('row_count', sa.Integer(), nullable=True),
    sa.Column('column_count', sa.Integer(), nullable=True),
    sa.Column('header_row_detected', sa.Integer(), nullable=True),
    sa.Column('raw_headers', sa.Text(), nullable=True),
    sa.Column('sample_data', sa.Text(), nullable=True),
    sa.Column('status', sa.String(length=50), nullable=False),
    sa.Column('processing_error', sa.Text(), nullable=True),
    sa.Column('processed_at', sa.DateTime(), nullable=True),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['factory_id'], ['factories.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['production_line_id'], ['production_lines.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['uploaded_by_id'], ['users.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_raw_imports_data_source_id'), 'raw_imports', ['data_source_id'], unique=False)
    op.create_index(op.f('ix_raw_imports_factory_id'), 'raw_imports', ['factory_id'], unique=False)
    op.create_index(op.f('ix_raw_imports_production_line_id'), 'raw_imports', ['production_line_id'], unique=False)
    op.create_index(op.f('ix_raw_imports_uploaded_by_id'), 'raw_imports', ['uploaded_by_id'], unique=False)
    op.create_table('schema_mappings',
    sa.Column('data_source_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('version', sa.Integer(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('column_map', sa.JSON(), nullable=False),
    sa.Column('extraction_rules', sa.JSON(), nullable=True),
    sa.Column('reviewed_by_user', sa.Boolean(), nullable=False),
    sa.Column('user_notes', sa.Text(), nullable=True),
    sa.Column('matching_tier', sa.String(length=20), nullable=True),
    sa.Column('tier_confidence', sa.Float(), nullable=True),
    sa.Column('tier_breakdown', sa.JSON(), nullable=True),
    sa.Column('fuzzy_scores', sa.JSON(), nullable=True),
    sa.Column('user_corrected', sa.Boolean(), nullable=False),
    sa.Column('correction_count', sa.Integer(), nullable=True),
    sa.Column('correction_history', sa.JSON(), nullable=True),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['data_source_id'], ['data_sources.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_schema_mappings_data_source_id'), 'schema_mappings', ['data_source_id'], unique=False)
    op.create_table('user_scopes',
    sa.Column('user_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('scope_type', sa.Enum('ORGANIZATION', 'FACTORY', 'LINE', name='rolescope'), nullable=False),
    sa.Column('organization_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('factory_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('production_line_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('role', sa.Enum('SYSTEM_ADMIN', 'OWNER', 'MANAGER', 'ANALYST', 'VIEWER', name='userrole'), nullable=False),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['factory_id'], ['factories.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['production_line_id'], ['production_lines.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_user_scopes_user_id'), 'user_scopes', ['user_id'], unique=False)
    op.create_table('data_quality_issues',
    sa.Column('raw_import_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('row_number', sa.Integer(), nullable=True),
    sa.Column('issue_type', sa.String(length=50), nullable=False),
    sa.Column('severity', sa.String(length=20), nullable=False),
    sa.Column('message', sa.Text(), nullable=False),
    sa.Column('field_name', sa.String(length=100), nullable=True),
    sa.Column('field_value', sa.String(length=500), nullable=True),
    sa.Column('resolved_at', sa.DateTime(), nullable=True),
    sa.Column('resolved_by_user_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('resolution_notes', sa.Text(), nullable=True),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['raw_import_id'], ['raw_imports.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['resolved_by_user_id'], ['users.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_data_quality_issues_issue_type'), 'data_quality_issues', ['issue_type'], unique=False)
    op.create_index(op.f('ix_data_quality_issues_raw_import_id'), 'data_quality_issues', ['raw_import_id'], unique=False)
    op.create_index(op.f('ix_data_quality_issues_severity'), 'data_quality_issues', ['severity'], unique=False)
    op.create_table('production_runs',
    sa.Column('factory_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('order_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('line_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('source_import_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('production_date', sa.DateTime(), nullable=True),
    sa.Column('inspection_date', sa.DateTime(), nullable=True),
    sa.Column('shift', sa.String(length=20), nullable=False),
    sa.Column('planned_qty', sa.Integer(), nullable=True),
    sa.Column('actual_qty', sa.Integer(), nullable=False),
    sa.Column('wip_start', sa.Integer(), nullable=True),
    sa.Column('wip_end', sa.Integer(), nullable=True),
    sa.Column('lot_number', sa.String(length=50), nullable=True),
    sa.Column('shade_band', sa.String(length=10), nullable=True),
    sa.Column('batch_number', sa.String(length=50), nullable=True),
    sa.Column('downtime_minutes', sa.Integer(), nullable=True),
    sa.Column('downtime_reason', sa.String(length=255), nullable=True),
    sa.Column('sam', sa.Numeric(precision=12, scale=4), nullable=True),
    sa.Column('operators_present', sa.Integer(), nullable=False),
    sa.Column('helpers_present', sa.Integer(), nullable=False),
    sa.Column('worked_minutes', sa.Numeric(precision=12, scale=4), nullable=False),
    sa.Column('earned_minutes', sa.Numeric(precision=15, scale=4), sa.Computed('actual_qty * sam', ), nullable=True),
    sa.Column('efficiency', sa.Numeric(precision=10, scale=2), sa.Computed('\n            CASE\n                WHEN (worked_minutes * (operators_present + helpers_present)) > 0 AND sam IS NOT NULL\n                THEN ((actual_qty * sam) / (worked_minutes * (operators_present + helpers_present))) * 100\n                ELSE 0\n            END\n            ', ), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.CheckConstraint('actual_qty >= 0', name='check_positive_qty'),
    sa.CheckConstraint('helpers_present >= 0', name='check_positive_helpers'),
    sa.CheckConstraint('operators_present >= 0', name='check_positive_operators'),
    sa.CheckConstraint('wip_end >= 0 OR wip_end IS NULL', name='check_positive_wip_end'),
    sa.CheckConstraint('wip_start >= 0 OR wip_start IS NULL', name='check_positive_wip_start'),
    sa.CheckConstraint('worked_minutes >= 0', name='check_positive_worked_minutes'),
    sa.ForeignKeyConstraint(['factory_id'], ['factories.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['line_id'], ['production_lines.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['order_id'], ['orders.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['source_import_id'], ['raw_imports.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_production_runs_batch_number'), 'production_runs', ['batch_number'], unique=False)
    op.create_index(op.f('ix_production_runs_factory_id'), 'production_runs', ['factory_id'], unique=False)
    op.create_index(op.f('ix_production_runs_inspection_date'), 'production_runs', ['inspection_date'], unique=False)
    op.create_index(op.f('ix_production_runs_line_id'), 'production_runs', ['line_id'], unique=False)
    op.create_index(op.f('ix_production_runs_lot_number'), 'production_runs', ['lot_number'], unique=False)
    op.create_index(op.f('ix_production_runs_order_id'), 'production_runs', ['order_id'], unique=False)
    op.create_index(op.f('ix_production_runs_production_date'), 'production_runs', ['production_date'], unique=False)
    op.create_index(op.f('ix_production_runs_source_import_id'), 'production_runs', ['source_import_id'], unique=False)
    op.create_table('staging_records',
    sa.Column('raw_import_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('source_row_number', sa.Integer(), nullable=False),
    sa.Column('status', sa.String(length=50), nullable=False),
    sa.Column('validation_errors', sa.Text(), nullable=True),
    sa.Column('validation_warnings', sa.Text(), nullable=True),
    sa.Column('record_data', sa.Text(), nullable=False),
    sa.Column('normalized_data', sa.Text(), nullable=True),
    sa.Column('quality_score', sa.Float(), nullable=True),
    sa.Column('null_field_count', sa.Integer(), nullable=True),
    sa.Column('promoted_at', sa.DateTime(), nullable=True),
    sa.Column('promoted_to_table', sa.String(length=100), nullable=True),
    sa.Column('promoted_record_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['raw_import_id'], ['raw_imports.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_staging_records_raw_import_id'), 'staging_records', ['raw_import_id'], unique=False)
    op.create_table('efficiency_metrics',
    sa.Column('production_run_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('efficiency_pct', sa.Numeric(precision=6, scale=2), nullable=True),
    sa.Column('sam_target', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('sam_actual', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('sam_variance', sa.Numeric(precision=8, scale=2), nullable=True),
    sa.Column('sam_variance_pct', sa.Numeric(precision=6, scale=2), nullable=True),
    sa.Column('capacity_utilization_pct', sa.Numeric(precision=6, scale=2), nullable=True),
    sa.Column('performance_tier', sa.Enum('BELOW_TARGET', 'ON_TARGET', 'ABOVE_TARGET', name='performancetier'), nullable=True),
    sa.Column('factory_avg_efficiency', sa.Numeric(precision=6, scale=2), nullable=True),
    sa.Column('line_avg_efficiency', sa.Numeric(precision=6, scale=2), nullable=True),
    sa.Column('calculated_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['production_run_id'], ['production_runs.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_efficiency_metrics_production_run_id'), 'efficiency_metrics', ['production_run_id'], unique=True)
    op.create_table('production_events',
    sa.Column('timestamp', sa.DateTime(), nullable=False),
    sa.Column('event_type', sa.Enum('SCAN', 'BATCH_UPLOAD', 'MANUAL_ADJUSTMENT', 'IOT_SIGNAL', name='eventtype', native_enum=False), nullable=False),
    sa.Column('quantity', sa.Integer(), nullable=False),
    sa.Column('line_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('order_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('style_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('production_run_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('source_import_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('raw_data', sa.JSON(), nullable=True),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['line_id'], ['production_lines.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['order_id'], ['orders.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['production_run_id'], ['production_runs.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['source_import_id'], ['raw_imports.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['style_id'], ['styles.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_production_events_line_id'), 'production_events', ['line_id'], unique=False)
    op.create_index(op.f('ix_production_events_order_id'), 'production_events', ['order_id'], unique=False)
    op.create_index(op.f('ix_production_events_production_run_id'), 'production_events', ['production_run_id'], unique=False)
    op.create_index(op.f('ix_production_events_source_import_id'), 'production_events', ['source_import_id'], unique=False)
    op.create_index(op.f('ix_production_events_style_id'), 'production_events', ['style_id'], unique=False)
    op.create_index(op.f('ix_production_events_timestamp'), 'production_events', ['timestamp'], unique=False)
    op.create_table('production_outputs',
    sa.Column('worker_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('production_run_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('operation', sa.String(length=100), nullable=False),
    sa.Column('pieces_completed', sa.Integer(), nullable=False),
    sa.Column('sam_earned', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('minutes_worked', sa.Numeric(precision=8, scale=2), nullable=True),
    sa.Column('efficiency_pct', sa.Numeric(precision=5, scale=2), nullable=True),
    sa.Column('recorded_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['production_run_id'], ['production_runs.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['worker_id'], ['workers.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_production_outputs_production_run_id'), 'production_outputs', ['production_run_id'], unique=False)
    op.create_index(op.f('ix_production_outputs_worker_id'), 'production_outputs', ['worker_id'], unique=False)
    op.create_table('quality_inspections',
    sa.Column('production_run_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('inspector_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('inspection_type', sa.Enum('INLINE', 'ENDLINE', 'FINAL', 'AQL', name='inspectiontype'), nullable=False),
    sa.Column('units_checked', sa.Integer(), nullable=False),
    sa.Column('defects_found', sa.Integer(), nullable=False),
    sa.Column('units_rejected', sa.Integer(), nullable=False),
    sa.Column('units_reworked', sa.Integer(), nullable=False),
    sa.Column('dhu', sa.Numeric(precision=6, scale=2), nullable=True),
    sa.Column('defect_rate_pct', sa.Numeric(precision=5, scale=2), nullable=True),
    sa.Column('aql_level', sa.String(length=20), nullable=True),
    sa.Column('aql_result', sa.Enum('PASS', 'FAIL', 'PENDING', name='aqlresult'), nullable=True),
    sa.Column('inspected_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['inspector_id'], ['workers.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['production_run_id'], ['production_runs.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_quality_inspections_production_run_id'), 'quality_inspections', ['production_run_id'], unique=False)
    op.create_table('defects',
    sa.Column('inspection_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('worker_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('defect_type', sa.String(length=100), nullable=False),
    sa.Column('defect_code', sa.String(length=20), nullable=True),
    sa.Column('defect_category', sa.String(length=100), nullable=True),
    sa.Column('operation', sa.String(length=100), nullable=True),
    sa.Column('severity', sa.Enum('MINOR', 'MAJOR', 'CRITICAL', name='defectseverity'), nullable=False),
    sa.Column('is_reworkable', sa.Boolean(), nullable=False),
    sa.Column('is_reworked', sa.Boolean(), nullable=False),
    sa.Column('root_cause', sa.String(length=255), nullable=True),
    sa.Column('machine_id', sa.String(length=50), nullable=True),
    sa.Column('image_url', sa.String(length=500), nullable=True),
    sa.Column('count', sa.Integer(), nullable=False),
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['inspection_id'], ['quality_inspections.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['worker_id'], ['workers.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_defects_defect_type'), 'defects', ['defect_type'], unique=False)
    op.create_index(op.f('ix_defects_inspection_id'), 'defects', ['inspection_id'], unique=False)
    op.create_index(op.f('ix_defects_worker_id'), 'defects', ['worker_id'], unique=False)
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_defects_worker_id'), table_name='defects')
    op.drop_index(op.f('ix_defects_inspection_id'), table_name='defects')
    op.drop_index(op.f('ix_defects_defect_type'), table_name='defects')
    op.drop_table('defects')
    op.drop_index(op.f('ix_quality_inspections_production_run_id'), table_name='quality_inspections')
    op.drop_table('quality_inspections')
    op.drop_index(op.f('ix_production_outputs_worker_id'), table_name='production_outputs')
    op.drop_index(op.f('ix_production_outputs_production_run_id'), table_name='production_outputs')
    op.drop_table('production_outputs')
    op.drop_index(op.f('ix_production_events_timestamp'), table_name='production_events')
    op.drop_index(op.f('ix_production_events_style_id'), table_name='production_events')
    op.drop_index(op.f('ix_production_events_source_import_id'), table_name='production_events')
    op.drop_index(op.f('ix_production_events_production_run_id'), table_name='production_events')
    op.drop_index(op.f('ix_production_events_order_id'), table_name='production_events')
    op.drop_index(op.f('ix_production_events_line_id'), table_name='production_events')
    op.drop_table('production_events')
    op.drop_index(op.f('ix_efficiency_metrics_production_run_id'), table_name='efficiency_metrics')
    op.drop_table('efficiency_metrics')
    op.drop_index(op.f('ix_staging_records_raw_import_id'), table_name='staging_records')
    op.drop_table('staging_records')
    op.drop_index(op.f('ix_production_runs_source_import_id'), table_name='production_runs')
    op.drop_index(op.f('ix_production_runs_production_date'), table_name='production_runs')
    op.drop_index(op.f('ix_production_runs_order_id'), table_name='production_runs')
    op.drop_index(op.f('ix_production_runs_lot_number'), table_name='production_runs')
    op.drop_index(op.f('ix_production_runs_line_id'), table_name='production_runs')
    op.drop_index(op.f('ix_production_runs_inspection_date'), table_name='production_runs')
    op.drop_index(op.f('ix_production_runs_factory_id'), table_name='production_runs')
    op.drop_index(op.f('ix_production_runs_batch_number'), table_name='production_runs')
    op.drop_table('production_runs')
    op.drop_index(op.f('ix_data_quality_issues_severity'), table_name='data_quality_issues')
    op.drop_index(op.f('ix_data_quality_issues_raw_import_id'), table_name='data_quality_issues')
    op.drop_index(op.f('ix_data_quality_issues_issue_type'), table_name='data_quality_issues')
    op.drop_table('data_quality_issues')
    op.drop_index(op.f('ix_user_scopes_user_id'), table_name='user_scopes')
    op.drop_table('user_scopes')
    op.drop_index(op.f('ix_schema_mappings_data_source_id'), table_name='schema_mappings')
    op.drop_table('schema_mappings')
    op.drop_index(op.f('ix_raw_imports_uploaded_by_id'), table_name='raw_imports')
    op.drop_index(op.f('ix_raw_imports_production_line_id'), table_name='raw_imports')
    op.drop_index(op.f('ix_raw_imports_factory_id'), table_name='raw_imports')
    op.drop_index(op.f('ix_raw_imports_data_source_id'), table_name='raw_imports')
    op.drop_table('raw_imports')
    op.drop_index(op.f('ix_orders_style_id'), table_name='orders')
    op.drop_index(op.f('ix_orders_status'), table_name='orders')
    op.drop_index(op.f('ix_orders_po_number'), table_name='orders')
    op.drop_table('orders')
    op.drop_index(op.f('ix_alias_mappings_source_alias_normalized'), table_name='alias_mappings')
    op.drop_index(op.f('ix_alias_mappings_source_alias'), table_name='alias_mappings')
    op.drop_index(op.f('ix_alias_mappings_scope'), table_name='alias_mappings')
    op.drop_index(op.f('ix_alias_mappings_organization_id'), table_name='alias_mappings')
    op.drop_index(op.f('ix_alias_mappings_factory_id'), table_name='alias_mappings')
    op.drop_index(op.f('ix_alias_mappings_canonical_field'), table_name='alias_mappings')
    op.drop_table('alias_mappings')
    op.drop_index(op.f('ix_ai_decisions_data_source_id'), table_name='ai_decisions')
    op.drop_index(op.f('ix_ai_decisions_agent_type'), table_name='ai_decisions')
    op.drop_table('ai_decisions')
    op.drop_index(op.f('ix_worker_skills_worker_id'), table_name='worker_skills')
    op.drop_index(op.f('ix_worker_skills_operation'), table_name='worker_skills')
    op.drop_table('worker_skills')
    op.drop_index(op.f('ix_worker_attendances_worker_id'), table_name='worker_attendances')
    op.drop_index(op.f('ix_worker_attendances_work_date'), table_name='worker_attendances')
    op.drop_table('worker_attendances')
    op.drop_index(op.f('ix_users_organization_id'), table_name='users')
    op.drop_table('users')
    op.drop_index(op.f('ix_styles_style_number'), table_name='styles')
    op.drop_index(op.f('ix_styles_factory_id'), table_name='styles')
    op.drop_index(op.f('ix_styles_buyer'), table_name='styles')
    op.drop_table('styles')
    op.drop_index(op.f('ix_dhu_reports_report_date'), table_name='dhu_reports')
    op.drop_index(op.f('ix_dhu_reports_factory_id'), table_name='dhu_reports')
    op.drop_table('dhu_reports')
    op.drop_index(op.f('ix_data_sources_production_line_id'), table_name='data_sources')
    op.drop_table('data_sources')
    op.drop_index(op.f('ix_workers_factory_id'), table_name='workers')
    op.drop_index(op.f('ix_workers_employee_id'), table_name='workers')
    op.drop_table('workers')
    op.drop_index(op.f('ix_production_lines_factory_id'), table_name='production_lines')
    op.drop_table('production_lines')
    op.drop_table('organizations')
    op.drop_index(op.f('ix_factories_organization_id'), table_name='factories')
    op.drop_table('factories')
    op.drop_index(op.f('ix_dashboards_user_id'), table_name='dashboards')
    op.drop_index(op.f('ix_dashboards_data_source_id'), table_name='dashboards')
    op.drop_table('dashboards')
    # ### end Alembic commands ###
