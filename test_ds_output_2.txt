============================= test session starts =============================
platform win32 -- Python 3.13.5, pytest-9.0.2, pluggy-1.6.0 -- C:\Python313\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\19803\Projects\FactoryExcelManager\backend
configfile: pytest.ini
plugins: anyio-4.12.0, Faker-40.1.0, langsmith-0.5.1, locust-2.43.0, asyncio-1.3.0, cov-7.0.0, mock-3.15.1
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 4 items

backend\tests\test_api\test_datasources_by_line.py::test_get_datasource_by_line_exists FAILED [ 25%]
backend\tests\test_api\test_datasources_by_line.py::test_get_datasource_by_line_none FAILED [ 50%]
backend\tests\test_api\test_datasources_by_line.py::test_get_datasource_cross_line_isolation FAILED [ 75%]
backend\tests\test_api\test_datasources_by_line.py::test_update_datasource FAILED [100%]

================================== FAILURES ===================================
_____________________ test_get_datasource_by_line_exists ______________________
backend\tests\test_api\test_datasources_by_line.py:84: in test_get_datasource_by_line_exists
    assert data["production_line_id"] == line.id
E   AssertionError: assert None == 'b365691c-4bf6-4086-bda1-8a385ee2b5fd'
E    +  where 'b365691c-4bf6-4086-bda1-8a385ee2b5fd' = <DataSource(id=b365691c-4bf6-4086-bda1-8a385ee2b5fd, name=Line A, factory_id=6e256b8f-a79f-4418-a0da-dd184d1528c7)>.id
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-16T08:22:11.819195Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: GET http://test/api/v1/data-sources/by-line/b365691c-4bf6-4086-bda1-8a385ee2b5fd \"HTTP/1.1 200 OK\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: GET http://test/api/v1/data-sources/by-line/b365691c-4bf6-4086-bda1-8a385ee2b5fd "HTTP/1.1 200 OK"
______________________ test_get_datasource_by_line_none _______________________
backend\tests\test_api\test_datasources_by_line.py:101: in test_get_datasource_by_line_none
    assert response.json() is None  # Should be null, not 404
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AssertionError: assert {'created_at': '2026-02-16T08:22:12.456830', 'description': None, 'has_active_schema': False, 'id': 'db492fee-8da8-471b-91ca-98ed46758474', ...} is None
E    +  where {'created_at': '2026-02-16T08:22:12.456830', 'description': None, 'has_active_schema': False, 'id': 'db492fee-8da8-471b-91ca-98ed46758474', ...} = json()
E    +    where json = <Response [200 OK]>.json
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-16T08:22:12.470293Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: GET http://test/api/v1/data-sources/by-line/db492fee-8da8-471b-91ca-98ed46758474 \"HTTP/1.1 200 OK\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: GET http://test/api/v1/data-sources/by-line/db492fee-8da8-471b-91ca-98ed46758474 "HTTP/1.1 200 OK"
__________________ test_get_datasource_cross_line_isolation ___________________
backend\tests\test_api\test_datasources_by_line.py:144: in test_get_datasource_cross_line_isolation
    assert response_b.json() is None
E   AssertionError: assert {'created_at': '2026-02-16T08:22:12.817602', 'description': None, 'has_active_schema': False, 'id': 'e8702a5c-ee15-4773-b7e6-efd89f75d64f', ...} is None
E    +  where {'created_at': '2026-02-16T08:22:12.817602', 'description': None, 'has_active_schema': False, 'id': 'e8702a5c-ee15-4773-b7e6-efd89f75d64f', ...} = json()
E    +    where json = <Response [200 OK]>.json
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-16T08:22:12.834598Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: GET http://test/api/v1/data-sources/by-line/e8702a5c-ee15-4773-b7e6-efd89f75d64f \"HTTP/1.1 200 OK\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: GET http://test/api/v1/data-sources/by-line/e8702a5c-ee15-4773-b7e6-efd89f75d64f "HTTP/1.1 200 OK"
___________________________ test_update_datasource ____________________________
backend\tests\test_api\test_datasources_by_line.py:185: in test_update_datasource
    assert response.status_code == 200
E   assert 404 == 200
E    +  where 404 = <Response [404 Not Found]>.status_code
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-16T08:22:13.179318Z", "level": "INFO", "logger": "httpx", "message": "HTTP Request: PUT http://test/api/v1/data-sources/14bfbc02-352a-4e5d-821d-fc13cdca5ab5 \"HTTP/1.1 404 Not Found\""}
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1740 HTTP Request: PUT http://test/api/v1/data-sources/14bfbc02-352a-4e5d-821d-fc13cdca5ab5 "HTTP/1.1 404 Not Found"
=========================== short test summary info ===========================
FAILED backend\tests\test_api\test_datasources_by_line.py::test_get_datasource_by_line_exists
FAILED backend\tests\test_api\test_datasources_by_line.py::test_get_datasource_by_line_none
FAILED backend\tests\test_api\test_datasources_by_line.py::test_get_datasource_cross_line_isolation
FAILED backend\tests\test_api\test_datasources_by_line.py::test_update_datasource
============================== 4 failed in 3.39s ==============================
