"≡ƒº¬ Running Tests (in Docker)..."
docker compose exec backend pytest
time="2026-02-16T04:52:41-05:00" level=warning msg="C:\\Users\\19803\\Projects\\FactoryExcelManager\\docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
============================= test session starts ==============================
platform linux -- Python 3.11.14, pytest-9.0.2, pluggy-1.6.0 -- /usr/local/bin/python3.11
cachedir: .pytest_cache
rootdir: /app
configfile: pytest.ini
testpaths: tests
plugins: asyncio-1.3.0, Faker-40.4.0, langsmith-0.7.1, cov-7.0.0, anyio-4.12.1, mock-3.15.1
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 224 items

tests/api/test_analytics_flaws.py::test_hourly_production_no_events_returns_zeros PASSED [  0%]
tests/api/test_analytics_flaws.py::test_midnight_boundary_respects_timezone PASSED [  0%]
tests/api/v1/test_factory_settings.py::test_factory_settings_localization_and_snapshot PASSED [  1%]
tests/api/v1/test_team.py::test_assign_user_to_line PASSED               [  1%]
tests/api/v1/test_users.py::test_get_user_me PASSED                      [  2%]
tests/api/v1/test_users.py::test_update_user_me PASSED                   [  2%]
tests/api/v1/test_users.py::test_update_user_invalid_timezone PASSED     [  3%]
tests/api/v1/test_users.py::test_update_user_partial_preferences PASSED  [  3%]
tests/api/v1/test_users.py::test_update_user_invalid_preference_type PASSED [  4%]
tests/e2e/test_excel_to_dashboard.py::test_e2e_excel_ingestion_and_dashboard PASSED [  4%]
tests/test_api/test_ai_decisions.py::test_list_ai_decisions PASSED       [  4%]
tests/test_api/test_ai_decisions.py::test_list_ai_decisions_with_filters PASSED [  5%]
tests/test_api/test_ai_decisions.py::test_get_ai_decision_by_id PASSED   [  5%]
tests/test_api/test_ai_decisions.py::test_get_ai_decision_not_found PASSED [  6%]
tests/test_api/test_ai_decisions.py::test_get_data_source_ai_decisions PASSED [  6%]
tests/test_api/test_ai_decisions.py::test_ai_decisions_pagination PASSED [  7%]
tests/test_api/test_ai_decisions.py::test_ai_decisions_require_auth PASSED [  7%]
tests/test_api/test_analytics_real.py::test_get_overview_stats_real PASSED [  8%]
tests/test_api/test_analytics_real.py::test_get_production_chart_real PASSED [  8%]
tests/test_api/test_analytics_real.py::test_get_lowest_performers_real PASSED [  8%]
tests/test_api/test_analytics_real.py::test_get_discrepancies_real PASSED [  9%]
tests/test_api/test_auth.py::test_login_success PASSED                   [  9%]
tests/test_api/test_auth.py::test_login_invalid_password PASSED          [ 10%]
tests/test_api/test_auth.py::test_login_user_not_found PASSED            [ 10%]
tests/test_api/test_auth.py::test_register_success PASSED                [ 11%]
tests/test_api/test_dashboard_creation_flow.py::test_complete_dashboard_creation_flow PASSED [ 11%]
tests/test_api/test_dashboard_creation_flow.py::test_dashboard_creation_blocked_by_factory_quota PASSED [ 12%]
tests/test_api/test_dashboard_creation_flow.py::test_dashboard_creation_blocked_by_line_quota SKIPPED [ 12%]
tests/test_api/test_dashboard_creation_flow.py::test_multiple_dashboards_same_data_source PASSED [ 12%]
tests/test_api/test_dashboard_creation_flow.py::test_list_dashboards_filtered_by_factory PASSED [ 13%]
tests/test_api/test_dashboard_flow.py::test_edit_configuration PASSED    [ 13%]
tests/test_api/test_dashboard_flow.py::test_view_uploaded_files PASSED   [ 14%]
tests/test_api/test_dashboard_flow.py::test_upload_history_isolation PASSED [ 14%]
tests/test_api/test_dashboard_flow.py::test_upload_history_simple_endpoint PASSED [ 15%]
tests/test_api/test_dashboard_widgets.py::test_get_dhu_quality_trend PASSED [ 15%]
tests/test_api/test_dashboard_widgets.py::test_get_style_progress PASSED [ 16%]
tests/test_api/test_data_pipeline_robust.py::test_value_preservation_through_pipeline PASSED [ 16%]
tests/test_api/test_data_pipeline_robust.py::test_date_format_handling PASSED [ 16%]
tests/test_api/test_data_pipeline_robust.py::test_efficiency_normalization PASSED [ 17%]
tests/test_api/test_data_pipeline_robust.py::test_null_handling PASSED   [ 17%]
tests/test_api/test_data_pipeline_robust.py::test_data_integrity_across_multiple_rows PASSED [ 18%]
tests/test_api/test_data_pipeline_robust.py::test_style_and_order_creation PASSED [ 18%]
tests/test_api/test_data_pipeline_robust.py::test_duplicate_upload_handling PASSED [ 19%]
tests/test_api/test_data_pipeline_robust.py::test_multiple_widgets_receive_correct_data PASSED [ 19%]
tests/test_api/test_data_pipeline_robust.py::test_invalid_data_handling PASSED [ 20%]
tests/test_api/test_data_pipeline_robust.py::test_analytics_sum_matches_database PASSED [ 20%]
tests/test_api/test_datasource.py::test_create_data_source PASSED        [ 20%]
tests/test_api/test_datasource.py::test_get_data_source PASSED           [ 21%]
tests/test_api/test_datasource.py::test_get_data_source_by_line PASSED   [ 21%]
tests/test_api/test_datasource.py::test_update_schema_mapping PASSED     [ 22%]
tests/test_api/test_datasource.py::test_create_duplicate_data_source_fails PASSED [ 22%]
tests/test_api/test_datasources_by_line.py::test_get_datasource_by_line_exists PASSED [ 23%]
tests/test_api/test_demo_pipeline.py::test_demo_full_pipeline_with_excel_file PASSED [ 23%]
tests/test_api/test_demo_pipeline.py::test_demo_data_values_integrity PASSED [ 24%]
tests/test_api/test_destructive_flows.py::test_delete_datasource_cascade PASSED [ 24%]
tests/test_api/test_destructive_flows.py::test_permissions_restricted_delete PASSED [ 25%]
tests/test_api/test_dry_run_flow.py::test_dry_run_preview_structure PASSED [ 25%]
tests/test_api/test_dry_run_flow.py::test_date_auto_fixing_detection PASSED [ 25%]
tests/test_api/test_dry_run_flow.py::test_efficiency_percentage_cleaning PASSED [ 26%]
tests/test_api/test_dry_run_flow.py::test_decimal_field_handling PASSED  [ 26%]
tests/test_api/test_dry_run_flow.py::test_integer_field_cleaning PASSED  [ 27%]
tests/test_api/test_dry_run_flow.py::test_column_mapping_application PASSED [ 27%]
tests/test_api/test_dry_run_flow.py::test_overall_status_with_warnings PASSED [ 28%]
tests/test_api/test_dry_run_flow.py::test_overall_status_all_valid PASSED [ 28%]
tests/test_api/test_dry_run_flow.py::test_promotion_after_dry_run_approval PASSED [ 29%]
tests/test_api/test_dry_run_flow.py::test_dry_run_with_missing_schema_mapping PASSED [ 29%]
tests/test_api/test_dry_run_flow.py::test_dry_run_limits_to_20_rows PASSED [ 29%]
tests/test_api/test_dry_run_flow.py::test_raw_data_preserved_in_preview PASSED [ 30%]
tests/test_api/test_error_handling.py::test_404_json_response PASSED     [ 30%]
tests/test_api/test_error_handling.py::test_validation_error_json_response PASSED [ 31%]
tests/test_api/test_error_handling.py::test_upload_bad_file_json_response PASSED [ 31%]
tests/test_api/test_error_handling.py::test_delete_204_response PASSED   [ 32%]
tests/test_api/test_excel_to_widget_integrity.py::test_golden_master_excel_to_overview_widget PASSED [ 32%]
tests/test_api/test_excel_to_widget_integrity.py::test_golden_master_physics_validation_triggers PASSED [ 33%]
tests/test_api/test_factories.py::test_create_factory PASSED             [ 33%]
tests/test_api/test_factories.py::test_list_factories PASSED             [ 33%]
tests/test_api/test_factories.py::test_production_line_crud PASSED       [ 34%]
tests/test_api/test_fallback_logic.py::test_overview_fallback PASSED     [ 34%]
tests/test_api/test_fallback_logic.py::test_production_chart_fallback PASSED [ 35%]
tests/test_api/test_fallback_logic.py::test_sam_performance_fallback PASSED [ 35%]
tests/test_api/test_fallback_logic.py::test_hourly_fallback PASSED       [ 36%]
tests/test_api/test_individual_widgets.py::test_get_hourly_production PASSED [ 36%]
tests/test_api/test_individual_widgets.py::test_get_sam_performance PASSED [ 37%]
tests/test_api/test_individual_widgets.py::test_get_workforce_stats PASSED [ 37%]
tests/test_api/test_individual_widgets.py::test_get_dhu_history PASSED   [ 37%]
tests/test_api/test_individual_widgets.py::test_get_speed_vs_quality PASSED [ 38%]
tests/test_api/test_individual_widgets.py::test_get_complexity_impact PASSED [ 38%]
tests/test_api/test_individual_widgets.py::test_get_downtime_reasons PASSED [ 39%]
tests/test_api/test_ingestion_deduplication.py::test_ingestion_deduplication PASSED [ 39%]
tests/test_api/test_ingestion_deduplication.py::test_mapping_state_endpoint PASSED [ 40%]
tests/test_api/test_ingestion_deduplication.py::test_process_idempotency PASSED [ 40%]
tests/test_api/test_ingestion_flow.py::test_full_ingestion_flow PASSED   [ 41%]
tests/test_api/test_ingestion_flow.py::test_schema_evolution PASSED      [ 41%]
tests/test_api/test_integrity.py::test_pydantic_validation PASSED        [ 41%]
tests/test_api/test_integrity.py::test_canonical_mapping_validation PASSED [ 42%]
tests/test_api/test_integrity.py::test_order_hybrid_property PASSED      [ 42%]
tests/test_api/test_integrity.py::test_production_run_constraints PASSED [ 43%]
tests/test_api/test_line_management.py::test_reset_schema_configuration PASSED [ 43%]
tests/test_api/test_line_management.py::test_clear_upload_history PASSED [ 44%]
tests/test_api/test_organizations.py::test_get_my_organization PASSED    [ 44%]
tests/test_api/test_organizations.py::test_update_my_organization PASSED [ 45%]
tests/test_api/test_organizations.py::test_get_organization_by_id PASSED [ 45%]
tests/test_api/test_preview.py::test_preview_endpoint_success PASSED     [ 45%]
tests/test_api/test_preview.py::test_list_uploads_includes_datasource_id PASSED [ 46%]
tests/test_api/test_preview_dry_run_endpoint.py::test_preview_dry_run_endpoint PASSED [ 46%]
tests/test_api/test_production.py::test_production_run_lifecycle PASSED  [ 47%]
tests/test_api/test_production.py::test_create_run_factory_mismatch PASSED [ 47%]
tests/test_api/test_promotion.py::test_promotion_logic_full_cycle PASSED [ 48%]
tests/test_api/test_quality_constraints.py::test_quality_inspection_allows_different_types_per_run PASSED [ 48%]
tests/test_api/test_quality_constraints.py::test_quality_inspection_rejects_duplicate_type_per_run PASSED [ 49%]
tests/test_api/test_quality_import.py::test_quality_data_promotion PASSED [ 49%]
tests/test_api/test_quota_enforcement.py::test_factory_quota_enforced PASSED [ 50%]
tests/test_api/test_quota_enforcement.py::test_line_quota_enforced PASSED [ 50%]
tests/test_api/test_quota_enforcement.py::test_soft_deleted_factories_not_counted PASSED [ 50%]
tests/test_api/test_quota_enforcement.py::test_quota_status_endpoint PASSED [ 51%]
tests/test_api/test_quota_enforcement.py::test_enterprise_tier_quotas PASSED [ 51%]
tests/test_api/test_quota_enforcement.py::test_quota_at_exact_limit PASSED [ 52%]
tests/test_api/test_quota_enforcement.py::test_zero_quota_blocks_creation PASSED [ 52%]
tests/test_api/test_repro_500.py::test_list_dashboards_by_factory_id_crash PASSED [ 53%]
tests/test_api/test_samples.py::test_list_sample_files PASSED            [ 53%]
tests/test_api/test_samples.py::test_download_sample_file PASSED         [ 54%]
tests/test_api/test_samples.py::test_download_csv_sample_file PASSED     [ 54%]
tests/test_api/test_samples.py::test_download_nonexistent_file PASSED    [ 54%]
tests/test_api/test_samples.py::test_download_with_path_traversal_attempt PASSED [ 55%]
tests/test_api/test_samples.py::test_sample_files_have_descriptions PASSED [ 55%]
tests/test_api/test_schema_config.py::test_schema_configuration_flow PASSED [ 56%]
tests/test_api/test_schema_mapping_reuse.py::test_confirm_mapping_deactivates_previous PASSED [ 56%]
tests/test_api/test_schema_mapping_reuse.py::test_schema_mapping_version_increments_correctly PASSED [ 57%]
tests/test_api/test_storage_separation.py::test_storage_segmentation PASSED [ 57%]
tests/test_api/test_style_progress.py::test_get_style_progress_with_pending_orders PASSED [ 58%]
tests/test_api/test_upload.py::TestUploadEndpoints::test_upload_endpoint_requires_auth PASSED [ 58%]
tests/test_api/test_upload.py::TestUploadEndpoints::test_upload_rejects_non_excel PASSED [ 58%]
tests/test_api/test_upload.py::TestUploadEndpoints::test_upload_accepts_xlsx PASSED [ 59%]
tests/test_api/test_upload_history.py::test_upload_history_segmentation PASSED [ 59%]
tests/test_api/test_upload_preview.py::test_upload_csv_file PASSED       [ 60%]
tests/test_api/test_upload_preview.py::test_preview_csv_file PASSED      [ 60%]
tests/test_api/test_upload_preview.py::test_preview_excel_file PASSED    [ 61%]
tests/test_api/test_upload_preview.py::test_preview_nonexistent_file PASSED [ 61%]
tests/test_api/test_upload_preview.py::test_upload_invalid_file_extension PASSED [ 62%]
tests/test_api/test_verification_cascade.py::test_factory_deletion_cascade_behavior PASSED [ 62%]
tests/test_api/test_widget_data_e2e.py::test_full_widget_data_flow PASSED [ 62%]
tests/test_api/test_widget_data_e2e.py::test_widget_endpoint_with_line_filter SKIPPED [ 63%]
tests/test_async_flow.py::test_datasource_lifecycle PASSED               [ 63%]
tests/test_datasource_flow.py::test_datasource_flow PASSED               [ 64%]
tests/test_ingestion/test_full_flow.py::test_full_data_flow PASSED       [ 64%]
tests/test_mapping_intelligence.py::test_mapping_engine_intelligence PASSED [ 65%]
tests/test_sequential_ingestion.py::test_jan_feb_march_continuity PASSED [ 65%]
tests/test_services/test_ai_decision_logging.py::test_ai_decision_creation PASSED [ 66%]
tests/test_services/test_ai_decision_logging.py::test_schema_inference_logging PASSED [ 66%]
tests/test_services/test_ai_decision_logging.py::test_code_generation_logging PASSED [ 66%]
tests/test_services/test_ai_decision_logging.py::test_ai_decision_without_db_session PASSED [ 67%]
tests/test_services/test_ai_decision_logging.py::test_ai_decision_data_source_relationship PASSED [ 67%]
tests/test_services/test_ai_decision_logging.py::test_ai_decision_confidence_calculation PASSED [ 68%]
tests/test_services/test_ai_decision_logging.py::test_ai_decision_metadata_completeness PASSED [ 68%]
tests/test_services/test_analytics_service.py::test_get_aggregated_stats_standard PASSED [ 69%]
tests/test_services/test_analytics_service.py::test_get_aggregated_stats_weighted_check PASSED [ 69%]
tests/test_services/test_analytics_service.py::test_validate_production_physics_rules PASSED [ 70%]
tests/test_services/test_date_parser.py::TestDateParser::test_native_types PASSED [ 70%]
tests/test_services/test_date_parser.py::TestDateParser::test_format_spec PASSED [ 70%]
tests/test_services/test_date_parser.py::TestDateParser::test_excel_serials PASSED [ 71%]
tests/test_services/test_date_parser.py::TestDateParser::test_heuristics_dayfirst PASSED [ 71%]
tests/test_services/test_date_parser.py::TestDateParser::test_diagnostics_return PASSED [ 72%]
tests/test_services/test_date_parser.py::TestDateParser::test_invalid_inputs PASSED [ 72%]
tests/test_services/test_excel_parser.py::TestFlexibleExcelParser::test_fuzzy_column_matching_qty PASSED [ 73%]
tests/test_services/test_excel_parser.py::TestFlexibleExcelParser::test_fuzzy_column_matching_po PASSED [ 73%]
tests/test_services/test_excel_parser.py::TestFlexibleExcelParser::test_header_scoring PASSED [ 74%]
tests/test_services/test_excel_parser.py::TestFlexibleExcelParser::test_clean_column_name PASSED [ 74%]
tests/test_services/test_excel_parser.py::TestFlexibleExcelParser::test_empty_columns_filtered PASSED [ 75%]
tests/test_services/test_file_processor.py::TestFileProcessorDryRun::test_dry_run_preview_basic PASSED [ 75%]
tests/test_services/test_file_processor.py::TestFileProcessorDryRun::test_dry_run_detects_date_warnings PASSED [ 75%]
tests/test_services/test_file_processor.py::TestFileProcessorDryRun::test_dry_run_shows_before_after PASSED [ 76%]
tests/test_services/test_file_processor.py::TestFileProcessorDryRun::test_dry_run_no_warnings_for_clean_data PASSED [ 76%]
tests/test_services/test_file_processor.py::TestFileProcessorDryRun::test_dry_run_limits_to_20_rows PASSED [ 77%]
tests/test_services/test_file_processor.py::TestDataCleaning::test_clean_date_messy_format PASSED [ 77%]
tests/test_services/test_file_processor.py::TestDataCleaning::test_clean_date_full_format PASSED [ 78%]
tests/test_services/test_file_processor.py::TestDataCleaning::test_clean_integer_fields PASSED [ 78%]
tests/test_services/test_file_processor.py::TestDataCleaning::test_clean_decimal_fields PASSED [ 79%]
tests/test_services/test_file_processor.py::TestDataCleaning::test_clean_efficiency_percentage PASSED [ 79%]
tests/test_services/test_file_processor.py::TestDataCleaning::test_clean_none_values PASSED [ 79%]
tests/test_services/test_file_processor.py::TestDataCleaning::test_clean_string_fields PASSED [ 80%]
tests/test_services/test_file_processor.py::TestProductionRunInsertion::test_promote_delegates_to_orchestrator PASSED [ 80%]
tests/test_services/test_file_processor.py::TestProductionRunInsertion::test_promote_handles_already_promoted PASSED [ 81%]
tests/test_services/test_fuzzy_matcher_optimized.py::test_fuzzy_matcher_wratio_handling PASSED [ 81%]
tests/test_services/test_fuzzy_matcher_optimized.py::test_short_word_protection PASSED [ 82%]
tests/test_services/test_fuzzy_matcher_optimized.py::test_industry_variations PASSED [ 82%]
tests/test_services/test_fuzzy_matcher_optimized.py::test_match_with_alternatives_deduplication PASSED [ 83%]
tests/test_services/test_fuzzy_matcher_optimized.py::test_performance_cached_keys PASSED [ 83%]
tests/test_services/test_matching_engine_new.py::test_hash_matcher_exact PASSED [ 83%]
tests/test_services/test_matching_engine_new.py::test_hash_matcher_alias PASSED [ 84%]
tests/test_services/test_matching_engine_new.py::test_fuzzy_matcher PASSED [ 84%]
tests/test_services/test_matching_engine_new.py::test_unmatched_column PASSED [ 85%]
tests/test_services/test_matching_engine_new.py::test_case_insensitivity PASSED [ 85%]
tests/test_services/test_matching_engine_new.py::test_operator_plurality_mismatch PASSED [ 86%]
tests/test_services/test_production_schema.py::TestProductionDateValidator::test_parse_mm_dd_format PASSED [ 86%]
tests/test_services/test_production_schema.py::TestProductionDateValidator::test_parse_mm_slash_dd_format PASSED [ 87%]
tests/test_services/test_production_schema.py::TestProductionDateValidator::test_parse_full_date_format PASSED [ 87%]
tests/test_services/test_production_schema.py::TestProductionDateValidator::test_parse_date_object PASSED [ 87%]
tests/test_services/test_production_schema.py::TestProductionDateValidator::test_target_qty_alias PASSED [ 88%]
tests/test_services/test_production_schema.py::TestProductionDateValidator::test_planned_qty_direct PASSED [ 88%]
tests/test_services/test_production_schema.py::TestProductionDateValidator::test_invalid_date_format PASSED [ 89%]
tests/test_services/test_production_schema.py::TestProductionDateValidator::test_optional_fields PASSED [ 89%]
tests/test_services/test_production_schema.py::TestProductionDateValidator::test_default_values PASSED [ 90%]
tests/test_services/test_production_schema.py::TestProductionDateValidator::test_edge_case_dates PASSED [ 90%]
tests/test_timezone_chaos.py::test_timezone_chaos_midnight_boundary PASSED [ 91%]
tests/test_widget_judge.py::test_judge_workforce_integrity_and_scope PASSED [ 91%]
tests/test_widget_judge.py::test_judge_overview_timezone_and_scope PASSED [ 91%]
tests/test_widget_judge.py::test_judge_no_fake_simulation PASSED         [ 92%]
tests/unit/services/ingestion/test_date_profiler.py::TestDetectColumnFormat::test_detects_iso_when_last_exceeds_12 PASSED [ 92%]
tests/unit/services/ingestion/test_date_profiler.py::TestDetectColumnFormat::test_detects_swap_when_middle_exceeds_12 PASSED [ 93%]
tests/unit/services/ingestion/test_date_profiler.py::TestDetectColumnFormat::test_early_exit_on_first_proof PASSED [ 93%]
tests/unit/services/ingestion/test_date_profiler.py::TestDetectColumnFormat::test_ambiguous_when_all_values_under_12 PASSED [ 94%]
tests/unit/services/ingestion/test_date_profiler.py::TestDetectColumnFormat::test_single_ambiguous_value PASSED [ 94%]
tests/unit/services/ingestion/test_date_profiler.py::TestDetectColumnFormat::test_impossible_date_both_exceed_12 PASSED [ 95%]
tests/unit/services/ingestion/test_date_profiler.py::TestDetectColumnFormat::test_mixed_constraint_violations PASSED [ 95%]
tests/unit/services/ingestion/test_date_profiler.py::TestDetectColumnFormat::test_february_30_invalid PASSED [ 95%]
tests/unit/services/ingestion/test_date_profiler.py::TestDetectColumnFormat::test_empty_list PASSED [ 96%]
tests/unit/services/ingestion/test_date_profiler.py::TestDetectColumnFormat::test_none_values_skipped PASSED [ 96%]
tests/unit/services/ingestion/test_date_profiler.py::TestDetectColumnFormat::test_non_date_strings_skipped PASSED [ 97%]
tests/unit/services/ingestion/test_date_profiler.py::TestDetectColumnFormat::test_slash_separator PASSED [ 97%]
tests/unit/services/ingestion/test_date_profiler.py::TestDetectColumnFormat::test_dot_separator PASSED [ 98%]
tests/unit/services/ingestion/test_date_profiler.py::TestDetectColumnFormat::test_mixed_separators PASSED [ 98%]
tests/unit/services/ingestion/test_date_profiler.py::TestDetectColumnFormat::test_respects_max_sample PASSED [ 99%]
tests/unit/services/ingestion/test_date_profiler.py::TestProfileDateColumn::test_returns_dict_with_expected_keys PASSED [ 99%]
tests/unit/services/ingestion/test_date_profiler.py::TestProfileDateColumn::test_profile_matches_detect_result PASSED [100%]

================== 222 passed, 2 skipped in 60.70s (0:01:00) ===================
